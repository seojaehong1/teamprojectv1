<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>제품 관리 - TORI COFFEE</title>

    <!-- CSS -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@900&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;600;700;900&display=swap">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

    <style>
        /* ========================================
           Design System - CSS Custom Properties
           ======================================== */
        :root {
            /* Primary Colors */
            --primary: #D95B3B;
            --primary-hover: #C74A2A;
            --primary-light: #FFF5F2;
            --primary-gradient: linear-gradient(135deg, #D95B3B, #E8734F);

            /* Grayscale */
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-400: #9CA3AF;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-800: #1F2937;
            --gray-900: #111827;

            /* Status Colors */
            --success: #10B981;
            --success-light: #D1FAE5;
            --warning: #F59E0B;
            --warning-light: #FEF3C7;
            --danger: #EF4444;
            --danger-light: #FEE2E2;
            --info: #3B82F6;
            --info-light: #DBEAFE;

            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);

            /* Border Radius */
            --radius-sm: 6px;
            --radius: 10px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --radius-full: 9999px;

            /* Transitions */
            --transition: 200ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 300ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ========================================
           Reset & Base Styles
           ======================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--gray-50);
            color: var(--gray-800);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* ========================================
           Fixed Header
           ======================================== */
        .head_wrap {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: #fff;
            box-shadow: var(--shadow-md);
            z-index: 1000;
        }

        .head {
            max-width: 1400px;
            margin: 0 auto;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            position: relative;
        }

        .head_logo a {
            display: flex;
            align-items: center;
        }

        .head_logo_img {
            height: 45px;
            width: auto;
        }

        /* Center Navigation */
        .head_menu_wrap {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        .head_menu ul {
            display: flex;
            gap: 8px;
            list-style: none;
        }

        .head_menu ul li a {
            display: block;
            padding: 10px 20px;
            color: var(--gray-600);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            border-radius: var(--radius-full);
            transition: var(--transition);
        }

        .head_menu ul li a:hover {
            background: var(--gray-100);
            color: var(--gray-900);
        }

        .head_menu ul li a.active,
        .head_menu ul li.active a {
            background: var(--primary);
            color: #fff;
        }

        /* User Menu */
        .head_user_wrap {
            display: flex;
            align-items: center;
        }

        .head_user_menu {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .head_login_wrap {
            position: relative;
        }

        .head_user_link {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            text-decoration: none;
            color: var(--gray-600);
            cursor: pointer;
            padding: 8px 12px;
            border-radius: var(--radius);
            transition: var(--transition);
        }

        .head_user_link:hover {
            background: var(--gray-100);
            color: var(--gray-900);
        }

        .head_user_link i {
            font-size: 18px;
        }

        .head_user_text {
            font-size: 12px;
            font-weight: 500;
        }

        .head_login_dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: #fff;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            min-width: 150px;
            display: none;
            z-index: 1001;
            overflow: hidden;
        }

        .head_login_wrap.active .head_login_dropdown {
            display: block;
        }

        .head_login_dropdown ul {
            list-style: none;
        }

        .head_login_dropdown ul li a {
            display: block;
            padding: 12px 16px;
            color: var(--gray-700);
            text-decoration: none;
            font-size: 14px;
            transition: var(--transition);
        }

        .head_login_dropdown ul li a:hover {
            background: var(--gray-50);
            color: var(--primary);
        }

        /* ========================================
           Main Content Area
           ======================================== */
        .admin_wrap {
            padding-top: 70px;
            min-height: 100vh;
            background: var(--gray-50);
        }

        .admin_content_wrap {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px 24px;
        }

        .admin_header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .admin_title {
            font-size: 28px;
            font-weight: 700;
            color: var(--gray-900);
        }

        /* Navigation Pills */
        .admin_nav {
            display: flex;
            gap: 8px;
            margin-bottom: 28px;
            flex-wrap: wrap;
        }

        .admin_nav_item {
            padding: 10px 20px;
            border: none;
            border-radius: var(--radius-full);
            background: #fff;
            color: var(--gray-600);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .admin_nav_item:hover {
            background: var(--gray-100);
            color: var(--gray-900);
        }

        .admin_nav_item.active {
            background: var(--primary-gradient);
            color: #fff;
            box-shadow: 0 4px 12px rgba(217, 91, 59, 0.3);
        }

        /* ========================================
           Toolbar
           ======================================== */
        .product_toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .product_search {
            display: flex;
            gap: 10px;
            flex: 1;
            max-width: 400px;
        }

        .product_search_input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            font-size: 14px;
            background: #fff;
            transition: var(--transition);
        }

        .product_search_input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(217, 91, 59, 0.1);
        }

        .product_search_btn {
            padding: 12px 20px;
            background: var(--gray-800);
            color: #fff;
            border: none;
            border-radius: var(--radius);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .product_search_btn:hover {
            background: var(--gray-900);
        }

        .product_add_btn {
            padding: 12px 24px;
            background: var(--primary-gradient);
            color: #fff;
            border: none;
            border-radius: var(--radius);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 4px 12px rgba(217, 91, 59, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .product_add_btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(217, 91, 59, 0.4);
        }

        /* ========================================
           Product Form
           ======================================== */
        .product_form_wrap {
            background: #fff;
            border-radius: var(--radius-lg);
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-lg);
        }

        .product_form_header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 28px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--gray-200);
        }

        .product_form_title {
            font-size: 22px;
            font-weight: 700;
            color: var(--gray-900);
        }

        .product_form_close {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gray-100);
            border: none;
            border-radius: var(--radius);
            font-size: 18px;
            cursor: pointer;
            color: var(--gray-600);
            transition: var(--transition);
        }

        .product_form_close:hover {
            background: var(--gray-200);
            color: var(--gray-900);
        }

        .product_form {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .product_form_row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .product_form_item {
            display: flex;
            flex-direction: column;
        }

        .product_form_label {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 8px;
        }

        .product_form_input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            font-size: 14px;
            transition: var(--transition);
            background: #fff;
        }

        .product_form_input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(217, 91, 59, 0.1);
        }

        textarea.product_form_input {
            resize: vertical;
            min-height: 100px;
        }

        .product_form_image_preview {
            width: 200px;
            height: 200px;
            object-fit: cover;
            border-radius: var(--radius);
            border: 1px solid var(--gray-200);
        }

        /* Ingredient Section */
        .product_ingredient_wrap {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .product_ingredient_list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .product_ingredient_item {
            display: flex;
            gap: 12px;
            align-items: center;
            padding: 14px 16px;
            background: var(--gray-50);
            border-radius: var(--radius);
            border: 1px solid var(--gray-100);
        }

        .product_ingredient_item select,
        .product_ingredient_item input {
            flex: 1;
            padding: 10px 14px;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-sm);
            font-size: 14px;
            background: #fff;
            transition: var(--transition);
        }

        .product_ingredient_item select:focus,
        .product_ingredient_item input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .product_ingredient_remove_btn {
            padding: 10px 16px;
            background: var(--danger);
            color: #fff;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .product_ingredient_remove_btn:hover {
            background: #DC2626;
        }

        .product_ingredient_add_btn {
            padding: 12px 18px;
            background: var(--gray-800);
            color: #fff;
            border: none;
            border-radius: var(--radius);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            align-self: flex-start;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .product_ingredient_add_btn:hover {
            background: var(--gray-900);
        }

        /* Option Section */
        .product_option_wrap {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .product_option_list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .product_option_item {
            display: flex;
            gap: 12px;
            align-items: center;
            padding: 14px 16px;
            background: var(--gray-50);
            border-radius: var(--radius);
            border: 1px solid var(--gray-100);
        }

        .product_option_item input {
            flex: 1;
            padding: 10px 14px;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-sm);
            font-size: 14px;
            background: #fff;
        }

        .product_option_remove_btn {
            padding: 10px 16px;
            background: var(--danger);
            color: #fff;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .product_option_remove_btn:hover {
            background: #DC2626;
        }

        .product_option_add_btn {
            padding: 12px 18px;
            background: var(--primary-gradient);
            color: #fff;
            border: none;
            border-radius: var(--radius);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            align-self: flex-start;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .product_option_add_btn:hover {
            transform: translateY(-1px);
        }

        /* Form Actions */
        .product_form_actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            justify-content: flex-end;
        }

        .product_form_btn {
            padding: 14px 32px;
            border: none;
            border-radius: var(--radius);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .product_form_btn.cancel {
            background: #fff;
            color: var(--gray-600);
            border: 1px solid var(--gray-300);
        }

        .product_form_btn.cancel:hover {
            background: var(--gray-50);
            border-color: var(--gray-400);
        }

        .product_form_btn.save {
            background: var(--primary-gradient);
            color: #fff;
            box-shadow: 0 4px 12px rgba(217, 91, 59, 0.3);
        }

        .product_form_btn.save:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(217, 91, 59, 0.4);
        }

        /* ========================================
           Info Sections (Nutrition & Allergy)
           ======================================== */
        .product_info_section {
            margin-top: 20px;
            padding: 24px;
            background: var(--gray-50);
            border-radius: var(--radius);
            border: 1px solid var(--gray-100);
        }

        .product_info_section .product_form_label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 15px;
            margin-bottom: 16px;
        }

        .product_info_section .product_form_label i {
            color: var(--primary);
        }

        .nutrition_grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
        }

        .nutrition_grid .product_form_item label {
            font-size: 12px;
            color: var(--gray-500);
            margin-bottom: 6px;
            display: block;
        }

        .nutrition_grid .product_form_input {
            padding: 10px 14px;
        }

        /* Allergy Grid */
        .allergy_grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .allergy_check_item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            background: #fff;
        }

        .allergy_check_item:hover {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .allergy_check_item.selected {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .allergy_check_item span {
            font-size: 14px;
            color: var(--gray-700);
            font-weight: 500;
        }

        .allergy_icon {
            width: 22px;
            height: 22px;
            border: 2px solid var(--primary);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .allergy_check_item.selected .allergy_icon {
            background: var(--primary);
        }

        .allergy_check_item.selected .allergy_icon i {
            color: #fff;
            font-size: 12px;
            display: block;
        }

        .allergy_icon i {
            display: none;
        }

        .allergy_check_item input[type="checkbox"] {
            display: none;
        }

        /* Option Group Buttons */
        .option_group_btn_wrap {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option_group_btn {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 18px;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            background: #fff;
            cursor: pointer;
            transition: var(--transition);
        }

        .option_group_btn:hover {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .option_group_btn_text {
            font-size: 15px;
            color: var(--gray-700);
            font-weight: 500;
        }

        .option_group_btn_text.selected {
            color: var(--primary);
            font-weight: 600;
        }

        .option_group_btn i {
            font-size: 14px;
            color: var(--gray-400);
        }

        /* ========================================
           Product Table
           ======================================== */
        .cont_text_wrap {
            background: #fff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .product_list_table {
            width: 100%;
            border-collapse: collapse;
        }

        .product_list_table thead {
            background: var(--gray-50);
        }

        .product_list_table th {
            padding: 16px 20px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--gray-200);
        }

        .product_list_table td {
            padding: 18px 20px;
            font-size: 14px;
            color: var(--gray-700);
            border-bottom: 1px solid var(--gray-100);
            vertical-align: middle;
        }

        .product_list_table tbody tr {
            transition: var(--transition);
        }

        .product_list_table tbody tr:hover {
            background: var(--gray-50);
        }

        .product_list_table tbody tr:last-child td {
            border-bottom: none;
        }

        .product_image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: var(--radius);
            box-shadow: var(--shadow-sm);
        }

        /* Action Buttons */
        .product_action_btn {
            padding: 8px 16px;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-sm);
            background: #fff;
            color: var(--gray-600);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            margin-right: 6px;
        }

        .product_action_btn:hover {
            background: var(--gray-100);
            border-color: var(--gray-300);
        }

        .product_action_btn.edit {
            background: var(--primary);
            border-color: var(--primary);
            color: #fff;
        }

        .product_action_btn.edit:hover {
            background: var(--primary-hover);
        }

        .product_action_btn.delete {
            background: var(--danger);
            border-color: var(--danger);
            color: #fff;
        }

        .product_action_btn.delete:hover {
            background: #DC2626;
        }

        /* ========================================
           Pagination
           ======================================== */
        .board_page_wrap {
            display: flex;
            justify-content: center;
            padding: 32px 0;
        }

        .board_page ul {
            display: flex;
            gap: 6px;
            list-style: none;
        }

        .board_page li {
            background: none !important;
        }

        .board_page li a {
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 40px;
            height: 40px;
            padding: 0 14px;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            background: #fff !important;
            color: var(--gray-600);
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
            transition: var(--transition);
            cursor: pointer;
        }

        .board_page li a:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: var(--primary-light) !important;
        }

        .board_page li.board_page_check a {
            background: var(--primary-gradient) !important;
            border-color: var(--primary);
            color: #fff;
            box-shadow: 0 2px 8px rgba(217, 91, 59, 0.3);
        }

        .board_page li a span {
            background: none !important;
        }

        /* ========================================
           Modals
           ======================================== */
        .product_modal_overlay,
        .delete_modal,
        .option_select_modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .product_modal_overlay.active,
        .delete_modal.show,
        .option_select_modal.active {
            display: flex;
        }

        /* Product Modal */
        .product_modal {
            background: #fff;
            width: 100%;
            max-width: 600px;
            border-radius: var(--radius-lg);
            padding: 32px;
            box-shadow: var(--shadow-xl);
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .product_modal_header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .product_modal_title {
            font-size: 20px;
            font-weight: 700;
            color: var(--gray-900);
        }

        .product_modal_close {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gray-100);
            border: none;
            border-radius: var(--radius);
            font-size: 16px;
            cursor: pointer;
            color: var(--gray-600);
            transition: var(--transition);
        }

        .product_modal_close:hover {
            background: var(--gray-200);
        }

        .product_modal_form_item {
            margin-bottom: 20px;
        }

        .product_modal_label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 8px;
        }

        .product_modal_input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            font-size: 14px;
            transition: var(--transition);
        }

        .product_modal_input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(217, 91, 59, 0.1);
        }

        .product_modal_image_preview {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: var(--radius);
            margin-top: 12px;
            border: 1px solid var(--gray-200);
        }

        .product_modal_actions {
            display: flex;
            gap: 12px;
            margin-top: 28px;
        }

        .product_modal_btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: var(--radius);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .product_modal_btn.cancel {
            background: var(--gray-100);
            color: var(--gray-600);
        }

        .product_modal_btn.cancel:hover {
            background: var(--gray-200);
        }

        .product_modal_btn.save {
            background: var(--primary-gradient);
            color: #fff;
        }

        .product_modal_btn.save:hover {
            opacity: 0.9;
        }

        /* Delete Modal */
        .delete_modal_content {
            background: #fff;
            border-radius: var(--radius-lg);
            padding: 32px;
            max-width: 400px;
            width: 100%;
            text-align: center;
            box-shadow: var(--shadow-xl);
            animation: modalSlideIn 0.3s ease;
        }

        .delete_modal_title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--gray-900);
        }

        .delete_modal_text {
            font-size: 15px;
            color: var(--gray-600);
            margin-bottom: 28px;
            line-height: 1.6;
        }

        .delete_modal_buttons {
            display: flex;
            gap: 12px;
        }

        .delete_modal_btn {
            flex: 1;
            padding: 14px;
            border-radius: var(--radius);
            border: none;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .delete_modal_btn.cancel {
            background: var(--gray-100);
            color: var(--gray-600);
        }

        .delete_modal_btn.cancel:hover {
            background: var(--gray-200);
        }

        .delete_modal_btn.confirm {
            background: var(--primary-gradient);
            color: #fff;
        }

        .delete_modal_btn.confirm:hover {
            opacity: 0.9;
        }

        .delete_modal_btn.close {
            width: 100%;
            padding: 14px;
            border-radius: var(--radius);
            border: none;
            background: var(--primary-gradient);
            color: #fff;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
        }

        .delete_modal_btn.close:hover {
            opacity: 0.9;
        }

        /* Option Select Modal */
        .option_select_modal_content {
            background: #fff;
            border-radius: var(--radius-lg);
            padding: 28px;
            max-width: 420px;
            width: 100%;
            max-height: 70vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
        }

        .option_select_modal_header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .option_select_modal_title {
            font-size: 18px;
            font-weight: 700;
            color: var(--gray-900);
        }

        .option_select_modal_close {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gray-100);
            border: none;
            border-radius: var(--radius);
            font-size: 14px;
            cursor: pointer;
            color: var(--gray-600);
        }

        .option_select_list {
            list-style: none;
            padding: 0;
            margin: 0 0 20px 0;
        }

        .option_select_item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            margin-bottom: 10px;
            cursor: pointer;
            transition: var(--transition);
        }

        .option_select_item:hover {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .option_select_item.selected {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .option_select_item_name {
            font-size: 14px;
            color: var(--gray-700);
        }

        .option_select_item_check {
            width: 22px;
            height: 22px;
            border: 2px solid var(--primary);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .option_select_item.selected .option_select_item_check {
            background: var(--primary);
        }

        .option_select_item.selected .option_select_item_check i {
            color: #fff;
            font-size: 12px;
            display: block;
        }

        .option_select_item_check i {
            display: none;
        }

        .option_select_confirm_btn {
            width: 100%;
            padding: 14px;
            background: var(--primary-gradient);
            color: #fff;
            border: none;
            border-radius: var(--radius);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .option_select_confirm_btn:hover {
            opacity: 0.9;
        }

        /* ========================================
           Footer
           ======================================== */
        .foot_menu_wrap {
            background: var(--gray-100);
            border-top: 1px solid var(--gray-200);
        }

        .foot_menu {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px 24px;
        }

        .foot_menu .cont_list ul {
            display: flex;
            gap: 24px;
            list-style: none;
            justify-content: center;
        }

        .foot_menu .cont_list ul li a {
            color: var(--gray-600);
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
        }

        .foot_menu .cont_list ul li a:hover {
            color: var(--primary);
        }

        .foot_wrap {
            background: var(--gray-800);
            padding: 40px 24px;
        }

        .foot {
            max-width: 1400px;
            margin: 0 auto;
        }

        .foot_logo img {
            height: 40px;
            filter: brightness(0) invert(1);
            margin-bottom: 20px;
        }

        .foot_info ul {
            display: flex;
            flex-wrap: wrap;
            gap: 8px 20px;
            list-style: none;
        }

        .foot_info ul li {
            color: var(--gray-400);
            font-size: 13px;
        }

        .foot_info ul li b {
            color: var(--gray-300);
        }

        /* Go Top Button */
        .go_top_wrap {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: var(--primary-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            transition: var(--transition);
            z-index: 999;
        }

        .go_top_wrap:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(217, 91, 59, 0.4);
        }

        .go_top_wrap::before {
            content: '';
            width: 12px;
            height: 12px;
            border-left: 2px solid #fff;
            border-top: 2px solid #fff;
            transform: rotate(45deg);
            margin-top: 4px;
        }

        /* ========================================
           Responsive
           ======================================== */
        @media (max-width: 1024px) {
            .head_menu_wrap {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .admin_header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }

            .product_toolbar {
                flex-direction: column;
            }

            .product_search {
                width: 100%;
                max-width: none;
            }

            .product_form_row {
                grid-template-columns: 1fr;
            }

            .nutrition_grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .allergy_grid {
                grid-template-columns: 1fr;
            }

            .product_list_table {
                font-size: 13px;
            }

            .product_list_table th,
            .product_list_table td {
                padding: 12px 10px;
            }

            .product_action_btn {
                padding: 6px 10px;
                font-size: 12px;
            }
        }
    </style>

    <!-- JavaScript -->
    <script src="https://code.jquery.com/jquery.min.js"></script>
</head>
<body>

<!-- 헤더 -->
<div class="head_wrap">
    <div class="head">
        <div class="head_logo">
            <a href="/admin/user">
                <img alt="TORI COFFEE 로고" class="head_logo_img" th:src="@{/logo/logo.png}">
            </a>
        </div>
        <div class="head_menu_wrap">
            <div class="head_menu">
                <ul>
                    <li><a href="/admin/user">회원 관리</a></li>
                    <li class="active"><a href="/admin/product">상품 관리</a></li>
                    <li><a href="/admin/notice">공지사항 관리</a></li>
                    <li><a href="/admin/inquiry">문의 관리</a></li>
                </ul>
            </div>
        </div>
        <div class="head_user_wrap">
            <div class="head_user_menu">
                <div class="head_user_item head_login_wrap">
                    <div class="head_login_state head_login_state_member">
                        <a href="#" class="head_user_link head_login_trigger">
                            <i class="far fa-user"></i>
                            <span class="head_user_text head_user_name">Admin</span>
                        </a>
                        <div class="head_login_dropdown">
                            <ul>
                                <li><a href="#" id="adminLogoutBtn">로그아웃</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 메인 콘텐츠 -->
<div class="admin_wrap">
    <div class="admin_content_wrap">
        <div class="admin_header">
            <div class="admin_title">제품 관리</div>
        </div>

        <!-- 네비게이션 -->
        <div class="admin_nav">
            <a href="/admin/user" class="admin_nav_item">회원 관리</a>
            <a href="/admin/product" class="admin_nav_item active">상품 관리</a>
            <a href="/admin/notice" class="admin_nav_item">공지사항 관리</a>
            <a href="/admin/inquiry" class="admin_nav_item">문의 관리</a>
        </div>

        <!-- 검색 및 필터 -->
        <div class="product_toolbar">
            <div class="product_search">
                <input type="text" class="product_search_input" placeholder="제품명으로 검색...">
                <button class="product_search_btn">검색</button>
            </div>
            <button class="product_add_btn" onclick="showAddForm()">
                <i class="fas fa-plus"></i> 제품 추가
            </button>
        </div>

        <!-- 제품 추가/수정 폼 -->
        <div class="product_form_wrap" id="productFormWrap" style="display: none;">
            <div class="product_form_header">
                <div class="product_form_title" id="productFormTitle">제품 추가</div>
                <button class="product_form_close" onclick="hideProductForm()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="productForm" class="product_form">
                <div class="product_form_row">
                    <div class="product_form_item">
                        <label class="product_form_label">제품명</label>
                        <input type="text" class="product_form_input" id="productName" required>
                    </div>
                    <div class="product_form_item">
                        <label class="product_form_label">카테고리</label>
                        <select class="product_form_input" id="productCategory" required>
                            <option value="">선택하세요</option>
                            <option value="음료" selected>음료</option>
                        </select>
                    </div>
                </div>
                <div class="product_form_row">
                    <div class="product_form_item">
                        <label class="product_form_label">가격</label>
                        <input type="number" class="product_form_input" id="productPrice" required min="0" placeholder="가격을 입력하세요">
                    </div>
                    <div class="product_form_item">
                        <label class="product_form_label">이미지</label>
                        <input type="file" class="product_form_input" id="productImage" accept="image/*" onchange="previewImage(this)">
                    </div>
                </div>
                <div class="product_form_row">
                    <div class="product_form_item" style="grid-column: 1 / -1;">
                        <label class="product_form_label">상세설명</label>
                        <textarea class="product_form_input" id="productDescription" rows="4" placeholder="상품 상세설명을 입력하세요"></textarea>
                    </div>
                </div>
                <div class="product_form_row" id="productImagePreviewRow" style="display: none;">
                    <div class="product_form_item">
                        <label class="product_form_label">이미지 미리보기</label>
                        <img id="productImagePreview" class="product_form_image_preview" alt="미리보기">
                    </div>
                </div>
                <div class="product_form_row">
                    <div class="product_form_item" style="grid-column: 1 / -1;">
                        <label class="product_form_label">옵션 설정 (등록된 옵션 선택)</label>
                        <div class="product_option_wrap">
                            <div id="productOptionGroupWrap" style="margin-bottom: 15px;">
                            </div>
                            <div class="product_option_list" id="productOptionList">
                            </div>
                            <button type="button" class="product_option_add_btn" onclick="addOptionItem()">
                                <i class="fas fa-plus"></i> 옵션 추가
                            </button>
                        </div>
                    </div>
                </div>

                <div class="product_info_section">
                    <label class="product_form_label"><i class="fas fa-info-circle"></i> 영양 상세정보 (1회 제공량 기준)</label>
                    <div class="nutrition_grid">
                        <div class="product_form_item">
                            <label>칼로리 (kcal)</label>
                            <input type="number" class="product_form_input" id="nutri_cal">
                        </div>
                        <div class="product_form_item">
                            <label>나트륨 (mg)</label>
                            <input type="number" class="product_form_input" id="nutri_sodium">
                        </div>
                        <div class="product_form_item">
                            <label>탄수화물 (g)</label>
                            <input type="number" class="product_form_input" id="nutri_carbo">
                        </div>
                        <div class="product_form_item">
                            <label>당류 (g)</label>
                            <input type="number" class="product_form_input" id="nutri_sugar">
                        </div>
                        <div class="product_form_item">
                            <label>단백질 (g)</label>
                            <input type="number" class="product_form_input" id="nutri_protein">
                        </div>
                        <div class="product_form_item">
                            <label>지방 (g)</label>
                            <input type="number" class="product_form_input" id="nutri_fat">
                        </div>
                        <div class="product_form_item">
                            <label>포화지방 (g)</label>
                            <input type="number" class="product_form_input" id="nutri_s_fat">
                        </div>
                        <div class="product_form_item">
                            <label>카페인 (mg)</label>
                            <input type="number" class="product_form_input" id="nutri_caffeine">
                        </div>
                    </div>
                </div>

                <div class="product_info_section">
                    <label class="product_form_label"><i class="fas fa-exclamation-triangle"></i> 알레르기 유발 요인</label>
                    <div style="font-size: 13px; color: var(--gray-500); margin-bottom: 16px;">해당되는 성분을 모두 선택해주세요.</div>
                    <div class="allergy_grid" id="allergyCheckWrap"></div>
                </div>

                <div class="product_form_row">
                    <div class="product_form_item" style="grid-column: 1 / -1;">
                        <label class="product_form_label">원재료</label>
                        <div class="product_ingredient_wrap">
                            <div class="product_ingredient_list" id="productIngredientList">
                            </div>
                            <button type="button" class="product_ingredient_add_btn" onclick="addIngredientItem()">
                                <i class="fas fa-plus"></i> 원재료 추가
                            </button>
                        </div>
                    </div>
                </div>
                <div class="product_form_actions">
                    <button type="button" class="product_form_btn cancel" onclick="hideProductForm()">취소</button>
                    <button type="submit" class="product_form_btn save">저장</button>
                </div>
            </form>
        </div>

        <!-- 제품 목록 -->
        <div class="cont_text_wrap" id="productListWrap">
            <table class="product_list_table">
                <thead>
                <tr>
                    <th>이미지</th>
                    <th>제품명</th>
                    <th>카테고리</th>
                    <th>가격</th>
                    <th>등록일</th>
                    <th>관리</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td><img src="https://via.placeholder.com/60" alt="제품" class="product_image"></td>
                    <td>아메리카노</td>
                    <td>음료</td>
                    <td>₩4,000</td>
                    <td>2024-01-01</td>
                    <td>
                        <button class="product_action_btn edit" onclick="editProduct(1)">수정</button>
                        <button class="product_action_btn delete" onclick="deleteProduct(1)">삭제</button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- 페이지네이션 -->
        <div class="board_page_wrap">
            <div class="board_page">
                <ul>
                    <li><a><span>처음</span></a></li>
                    <li class="board_page_check"><a><span>1</span></a></li>
                    <li><a><span>2</span></a></li>
                    <li><a><span>다음</span></a></li>
                    <li><a><span>마지막</span></a></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- 푸터 -->
<div class="foot_menu_wrap">
    <div class="foot_menu">
        <div class="cont_list">
            <ul>
                <li><a href="/policy/service_policy"><b>이용약관</b></a></li>
                <li><a href="/policy/privacy_policy"><b>개인정보처리방침</b></a></li>
            </ul>
        </div>
    </div>
</div>
<div class="foot_wrap">
    <div class="foot">
        <div class="foot_logo">
            <img alt="TORI COFFEE 로고" th:src="@{/logo/logo.png}">
        </div>
        <div class="foot_info">
            <ul>
                <li><b>팀 부리또</b></li>
                <li>대표 서재홍</li>
                <li>연락처 010-3030-7038</li>
                <li>이메일 wtme3@naver.com</li>
                <li>주소 동서울대학교</li>
                <li>팀원 이주희, 박윤호, 하성호</li>
            </ul>
        </div>
    </div>
</div>

<!-- 상단 이동 버튼 -->
<a href="javascript:go_top()">
    <div class="go_top_wrap"></div>
</a>

<!-- 제품 추가/수정 모달 -->
<div class="product_modal_overlay" id="productModal">
    <div class="product_modal">
        <div class="product_modal_header">
            <div class="product_modal_title" id="productModalTitle">제품 추가</div>
            <button class="product_modal_close" onclick="closeProductModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form id="productFormModal">
            <div class="product_modal_form_item">
                <label class="product_modal_label">제품명</label>
                <input type="text" class="product_modal_input" id="productNameModal" required>
            </div>
            <div class="product_modal_form_item">
                <label class="product_modal_label">카테고리</label>
                <select class="product_modal_input" id="productCategoryModal" required>
                    <option value="">선택하세요</option>
                    <option value="음료" selected>음료</option>
                </select>
            </div>
            <div class="product_modal_form_item">
                <label class="product_modal_label">가격</label>
                <input type="number" class="product_modal_input" id="productPriceModal" required min="0" placeholder="가격을 입력하세요">
            </div>
            <div class="product_modal_form_item">
                <label class="product_modal_label">상세설명</label>
                <textarea class="product_modal_input" id="productDescriptionModal" rows="4" placeholder="상품 상세설명을 입력하세요"></textarea>
            </div>
            <div class="product_modal_form_item">
                <label class="product_modal_label">옵션 설정</label>
                <div class="product_option_wrap">
                    <div class="product_option_list" id="productOptionListModal">
                    </div>
                    <button type="button" class="product_option_add_btn" onclick="addOptionItemModal()">
                        <i class="fas fa-plus"></i> 옵션 그룹 추가
                    </button>
                </div>
            </div>
            <div class="product_modal_form_item">
                <label class="product_modal_label">이미지</label>
                <input type="file" class="product_modal_input" id="productImageModal" accept="image/*" onchange="previewImageModal(this)">
                <img id="productImagePreviewModal" class="product_modal_image_preview" style="display: none;" alt="미리보기">
            </div>
            <div class="product_modal_actions">
                <button type="button" class="product_modal_btn cancel" onclick="closeProductModal()">취소</button>
                <button type="submit" class="product_modal_btn save">저장</button>
            </div>
        </form>
    </div>
</div>

<!-- 삭제 확인 모달 -->
<div class="delete_modal" id="deleteModal">
    <div class="delete_modal_content">
        <div class="delete_modal_title">삭제 확인</div>
        <div class="delete_modal_text">
            정말 삭제하시겠습니까?
        </div>
        <div class="delete_modal_buttons">
            <button type="button" class="delete_modal_btn cancel" onclick="closeDeleteModal()">취소</button>
            <button type="button" class="delete_modal_btn confirm" onclick="confirmDelete()">확인</button>
        </div>
    </div>
</div>

<!-- 삭제 완료 모달 -->
<div class="delete_modal" id="deleteSuccessModal">
    <div class="delete_modal_content">
        <div class="delete_modal_title">완료</div>
        <div class="delete_modal_text">
            제품이 삭제되었습니다.
        </div>
        <button type="button" class="delete_modal_btn close" onclick="closeDeleteSuccessModal()">확인</button>
    </div>
</div>

<!-- 수정 완료 모달 -->
<div class="delete_modal" id="editSuccessModal">
    <div class="delete_modal_content">
        <div class="delete_modal_title">완료</div>
        <div class="delete_modal_text">
            제품 정보가 수정되었습니다.
        </div>
        <button type="button" class="delete_modal_btn close" onclick="closeEditSuccessModal()">확인</button>
    </div>
</div>

<!-- 추가 완료 모달 -->
<div class="delete_modal" id="addSuccessModal">
    <div class="delete_modal_content">
        <div class="delete_modal_title">완료</div>
        <div class="delete_modal_text">
            제품이 추가되었습니다.
        </div>
        <button type="button" class="delete_modal_btn close" id="addSuccessModalBtn" onclick="closeAddSuccessModal()">확인</button>
    </div>
</div>

<!-- 옵션 선택 모달 -->
<div class="option_select_modal" id="optionSelectModal">
    <div class="option_select_modal_content">
        <div class="option_select_modal_header">
            <div class="option_select_modal_title" id="optionSelectModalTitle">옵션 선택</div>
            <button class="option_select_modal_close" onclick="closeOptionSelectModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <ul class="option_select_list" id="optionSelectList">
        </ul>
        <button class="option_select_confirm_btn" onclick="confirmOptionSelection()">선택 완료</button>
    </div>
</div>

<script>
    // Go to top function
    function go_top() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    const PRODUCT_API  = 'http://localhost:8000/api/admin/products';
    const OPTION_API   = 'http://localhost:8000/api/admin/options';
    const MATERIAL_API = 'http://localhost:8000/api/admin/materials';
    const ALLERGY_API  = 'http://localhost:8000/api/admin/allergies';
    const CATEGORY_API = 'http://localhost:8000/api/admin/categori';

    let currentPage = 1;
    const PAGE_SIZE = 10;
    let editingMenuCode = null;

    async function loadProductList(page = 1) {
        const res = await fetch(`${PRODUCT_API}?page=${page}&limit=${PAGE_SIZE}`);
        const data = await res.json();

        const tbody = document.querySelector('.product_list_table tbody');
        tbody.innerHTML = '';

        data.content.forEach(p => {
            const imagePath = `/src/tem/${p.menuName}.png`;
            const defaultImage = '/logo/logo.png';

            tbody.innerHTML += `
            <tr>
                <td>
                    <img src="${imagePath}"
                         class="product_image"
                         alt="${p.menuName}"
                         onerror="this.onerror=null; this.src='${defaultImage}';">
                </td>
                <td>${p.menuName}</td>
                <td>${p.category}</td>
                <td>₩${p.basePrice ? Number(p.basePrice).toLocaleString() : '-'}</td>
                <td>${p.createdAt ?? '-'}</td>
                <td>
                    <button class="product_action_btn edit" onclick="openEditProduct(${p.menuCode})">수정</button>
                    <button class="product_action_btn delete" onclick="deleteProduct(${p.menuCode})">삭제</button>
                </td>
            </tr>`;
        });

        renderPagination(data.totalPages, page);
    }

    async function searchProducts(page = 1) {
        const keyword = document.querySelector('.product_search_input').value.trim();

        if (!keyword) {
            loadProductList(1);
            return;
        }

        const res = await fetch(
            `${PRODUCT_API}/search?keyword=${encodeURIComponent(keyword)}&page=${page}&limit=${PAGE_SIZE}`
        );
        const data = await res.json();

        const tbody = document.querySelector('.product_list_table tbody');
        tbody.innerHTML = '';

        data.content.forEach(p => {
            const imagePath = `/src/tem/${p.menuName}.png`;
            const defaultImage = '/logo/logo.png';

            tbody.innerHTML += `
        <tr>
            <td>
                <img src="${imagePath}"
                     class="product_image"
                     alt="${p.menuName}"
                     onerror="this.onerror=null; this.src='${defaultImage}';">
            </td>
            <td>${p.menuName}</td>
            <td>${p.category}</td>
            <td>₩${Number(p.basePrice).toLocaleString()}</td>
            <td>-</td>
            <td>
                <button class="product_action_btn edit" onclick="openEditProduct(${p.menuCode})">수정</button>
                <button class="product_action_btn delete" onclick="deleteProduct(${p.menuCode})">삭제</button>
            </td>
        </tr>`;
        });

        renderPagination(data.totalPages, page);
    }

    // 권한 체크
    $(document).ready(function() {
        var userName = localStorage.getItem('userName') || 'Admin';
        $('.head_user_name').text(userName);

        // 로그인 드롭다운 토글
        $('.head_login_trigger').click(function(e) {
            e.preventDefault();
            e.stopPropagation();
            $('.head_login_wrap').toggleClass('active');
        });

        $(document).click(function(e) {
            if (!$(e.target).closest('.head_login_wrap').length) {
                $('.head_login_wrap').removeClass('active');
            }
        });

        // 로그아웃 버튼
        $('#adminLogoutBtn').on('click', function(e) {
            e.preventDefault();
            if (confirm('로그아웃하시겠습니까?')) {
                localStorage.clear();
                window.location.href = '/';
            }
        });

        // 알레르기 커스텀 체크박스 제어
        $(document).on('change', '.allergy_check_item input[type="checkbox"]', function() {
            if ($(this).is(':checked')) {
                $(this).closest('.allergy_check_item').addClass('selected');
            } else {
                $(this).closest('.allergy_check_item').removeClass('selected');
            }
        });
    });

    // 옵션 항목 추가 (인라인 폼)
    let optionCounter = 0;

    function addOptionItem() {
        optionCounter++;
        const options = [
            {id: 1, name: "샷 추가", basePrice: 500},
            {id: 2, name: "휘핑 추가", basePrice: 600},
            {id: 3, name: "사이즈 업(L)", basePrice: 1000}
        ];

        let selectHtml = `<div class="product_option_item" id="opt_${optionCounter}">
                <select class="product_form_input" style="flex:1;">
                    <option value="">적용할 옵션 선택</option>`;

        options.forEach(opt => {
            selectHtml += `<option value="${opt.id}">${opt.name} (+₩${opt.basePrice})</option>`;
        });

        selectHtml += `</select>
                <button type="button" class="product_option_remove_btn" onclick="$('#opt_${optionCounter}').remove()">삭제</button>
            </div>`;

        $('#productOptionList').append(selectHtml);
    }

    // 옵션 항목 추가 (모달)
    let optionCounterModal = 0;
    function addOptionItemModal() {
        optionCounterModal++;
        const optionItem = `
                <div class="product_option_item" data-option-id="${optionCounterModal}">
                    <input type="text" class="product_option_group_name" placeholder="옵션 그룹명 (예: 사이즈, 토핑)" required>
                    <input type="number" class="product_option_price" placeholder="추가 금액" required min="0" step="100">
                    <button type="button" class="product_option_remove_btn" onclick="removeOptionItemModal(${optionCounterModal})">삭제</button>
                </div>
            `;
        $('#productOptionListModal').append(optionItem);
    }

    // 옵션 항목 삭제 (인라인 폼)
    function removeOptionItem(id) {
        $(`.product_option_item[data-option-id="${id}"]`).remove();
    }

    // 옵션 항목 삭제 (모달)
    function removeOptionItemModal(id) {
        $(`.product_option_item[data-option-id="${id}"]`).remove();
    }

    // 원재료 항목 추가
    let ingredientCounter = 0;
    function addIngredientItem() {
        ingredientCounter++;
        const ingredientItem = `
                <div class="product_ingredient_item" data-ingredient-id="${ingredientCounter}">
                    <select class="product_ingredient_select" required>
                        <option value="">원재료 선택</option>
                        <option value="아메리카노 원두">아메리카노 원두</option>
                        <option value="라떼 원두">라떼 원두</option>
                        <option value="우유">우유</option>
                        <option value="시럽">시럽</option>
                        <option value="바닐라 시럽">바닐라 시럽</option>
                        <option value="카라멜 시럽">카라멜 시럽</option>
                        <option value="헤이즐넛 시럽">헤이즐넛 시럽</option>
                    </select>
                    <input type="number" class="product_ingredient_amount" placeholder="수량" required min="0" step="0.1">
                    <select class="product_ingredient_unit" required>
                        <option value="kg">kg</option>
                        <option value="L">L</option>
                        <option value="병">병</option>
                        <option value="개">개</option>
                        <option value="g">g</option>
                        <option value="ml">ml</option>
                    </select>
                    <button type="button" class="product_ingredient_remove_btn" onclick="removeIngredientItem(${ingredientCounter})">삭제</button>
                </div>
            `;
        $('#productIngredientList').append(ingredientItem);
    }

    // 원재료 항목 삭제
    function removeIngredientItem(id) {
        $(`.product_ingredient_item[data-ingredient-id="${id}"]`).remove();
    }

    // 제품 추가 폼 표시
    function showAddForm() {
        $('#productForm')[0].reset();
        $('#productFormTitle').text('제품 추가');
        $('#productImagePreviewRow').hide();
        $('#productIngredientList').empty();
        $('#productOptionList').empty();
        $('.allergy_check_item').removeClass('selected');
        $('.allergy_check_item input[type="checkbox"]').prop('checked', false);
        ingredientCounter = 0;
        optionCounter = 0;
        $('#productForm').data('productId', null);
        $('#productFormWrap').slideDown();
        $('#productListWrap').hide();
        $('html, body').animate({ scrollTop: $('.product_form_wrap').offset().top - 100 }, 300);
    }

    function fillNutrition(data) {
        if (!data) return;

        $('#nutri_cal').val(data.calories ?? '');
        $('#nutri_sodium').val(data.sodium ?? '');
        $('#nutri_carbo').val(data.carbs ?? '');
        $('#nutri_sugar').val(data.sugars ?? '');
        $('#nutri_protein').val(data.protein ?? '');
        $('#nutri_fat').val(data.fat ?? '');
        $('#nutri_s_fat').val(data.saturatedFat ?? '');
        $('#nutri_caffeine').val(data.caffeine ?? '');
    }

    function fillAllergies(allergyIds) {
        if (!Array.isArray(allergyIds)) return;

        $('input[name="allergy"]').each(function () {
            const id = Number(this.value);
            const checked = allergyIds.includes(id);

            $(this).prop('checked', checked)
                .closest('.allergy_check_item')
                .toggleClass('selected', checked);
        });
    }

    function fillOptions(optionIds) {
        if (!Array.isArray(optionIds) || optionIds.length === 0) return;

        window.selectedOptionsByGroup = {};

        window.optionGroupsData.forEach((group, groupIndex) => {
            const groupName = group.optionGroupName;
            const selectedInGroup = [];

            group.options.forEach(opt => {
                if (optionIds.includes(opt.optionId)) {
                    selectedInGroup.push({
                        id: opt.optionId,
                        name: opt.optionName,
                        price: opt.defaultPrice
                    });
                }
            });

            if (selectedInGroup.length > 0) {
                window.selectedOptionsByGroup[groupName] = selectedInGroup;

                const $btn = $(`.option_group_btn[data-group-name="${groupName}"]`);
                const text = selectedInGroup.length > 1
                    ? `${selectedInGroup[0].name} 외 ${selectedInGroup.length - 1}건`
                    : selectedInGroup[0].name;
                $btn.find('.option_group_btn_text').text(text).addClass('selected');
            }
        });
    }

    function fillIngredients(ingredients) {
        if (!ingredients) return;

        $('#productIngredientList').empty();
        ingredientCounter = 0;

        ingredients.forEach(i => {
            ingredientCounter++;

            $('#productIngredientList').append(`
            <div class="product_ingredient_item" data-ingredient-id="${ingredientCounter}">
                <select class="product_ingredient_select">
                    <option value="${i.name}" selected>${i.name}</option>
                </select>
                <input type="number" class="product_ingredient_amount" value="${i.amount}">
                <select class="product_ingredient_unit">
                    <option value="${i.unit}" selected>${i.unit}</option>
                </select>
            </div>
        `);
        });
    }

    // 제품 수정 폼 표시
    async function openEditProduct(menuCode) {
        const res = await fetch(`${PRODUCT_API}/${menuCode}`);
        const data = await res.json();

        editingMenuCode = menuCode;

        showAddForm();

        await loadSelectors();

        $('#productName').val(data.menuName);

        if (data.category) {
            $('#productCategory').val(data.category).prop('selected', true);
        }

        $('#productPrice').val(data.basePrice);
        $('#productDescription').val(data.description);

        fillNutrition(data);
        fillOptions(data.optionIds);
        fillIngredients(data.recipes);
        fillAllergies(data.allergyIds);
    }

    // 제품 폼 숨기기
    function hideProductForm() {
        $('#productFormWrap').slideUp();
        $('#productListWrap').show();
        $('#productForm')[0].reset();
        $('#productImagePreviewRow').hide();
        $('#productIngredientList').empty();
        $('#productOptionList').empty();
        $('.allergy_check_item').removeClass('selected');
        $('.allergy_check_item input[type="checkbox"]').prop('checked', false);
        window.selectedOptionsByGroup = {};
        $('.option_group_btn_text').each(function() {
            const groupName = $(this).closest('.option_group_btn').data('group-name');
            $(this).text(groupName).removeClass('selected');
        });
        ingredientCounter = 0;
        optionCounter = 0;
    }

    // 이미지 미리보기
    function previewImage(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                $('#productImagePreview').attr('src', e.target.result);
                $('#productImagePreviewRow').show();
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function previewImageModal(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                $('#productImagePreviewModal').attr('src', e.target.result).show();
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    // 제품 삭제
    let deleteProductId = null;
    function deleteProduct(id) {
        deleteProductId = id;
        $('#deleteModal').addClass('show');
    }

    // 삭제 확인
    async function confirmDelete() {
        if (!deleteProductId) return;

        await fetch(`${PRODUCT_API}/${deleteProductId}`, {
            method: 'DELETE'
        });

        closeDeleteModal();
        loadProductList(currentPage);
    }

    function closeDeleteModal() {
        $('#deleteModal').removeClass('show');
        deleteProductId = null;
    }

    function closeDeleteSuccessModal() {
        $('#deleteSuccessModal').removeClass('show');
        location.reload();
    }

    function closeEditSuccessModal() {
        $('#editSuccessModal').removeClass('show');
        location.reload();
    }

    function closeAddSuccessModal() {
        $('#addSuccessModal').removeClass('show');
        location.reload();
    }

    function closeProductModal() {
        $('#productModal').removeClass('active');
        $('#productOptionListModal').empty();
        optionCounterModal = 0;
    }

    // 제품 폼 제출
    $(document).ready(function() {
        document.getElementById('productForm').addEventListener('submit', async e => {
            e.preventDefault();

            const payload = {
                menuName: $('#productName').val(),
                category: $('#productCategory').val(),
                basePrice: Number($('#productPrice').val()),
                description: $('#productDescription').val(),
                optionIds: collectSelectedOptionIds(),
                customOptions: collectCustomOptions(),
                ingredients: collectIngredients(),
                allergyIds: collectAllergies(),
                nutrition: collectNutrition()
            };

            const url = editingMenuCode
                ? `${PRODUCT_API}/${editingMenuCode}`
                : PRODUCT_API;

            const method = editingMenuCode ? 'PUT' : 'POST';

            await fetch(url, {
                method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            editingMenuCode = null;
            hideProductForm();
            loadProductList(currentPage);
        });

        // 모달 외부 클릭 시 닫기
        $(document).on('click', '.delete_modal', function(e) {
            if ($(e.target).hasClass('delete_modal')) {
                closeDeleteModal();
                closeDeleteSuccessModal();
                closeEditSuccessModal();
                closeAddSuccessModal();
            }
        });
    });

    function collectNutrition() {
        return {
            calories: Number($('#nutri_cal').val()) || 0,
            sodium: Number($('#nutri_sodium').val()) || 0,
            carbs: Number($('#nutri_carbo').val()) || 0,
            sugars: Number($('#nutri_sugar').val()) || 0,
            protein: Number($('#nutri_protein').val()) || 0,
            fat: Number($('#nutri_fat').val()) || 0,
            saturatedFat: Number($('#nutri_s_fat').val()) || 0,
            caffeine: Number($('#nutri_caffeine').val()) || 0
        };
    }

    function collectCustomOptions() {
        return [...document.querySelectorAll('#productOptionList .product_option_item')]
            .map(el => ({
                optionId: el.querySelector('select')?.value || null
            }))
            .filter(o => o.optionId);
    }

    function collectIngredients() {
        return [...document.querySelectorAll('.product_ingredient_item')].map(el => ({
            name: el.querySelector('.product_ingredient_select').value,
            amount: Number(el.querySelector('.product_ingredient_amount').value),
            unit: el.querySelector('.product_ingredient_unit').value
        }));
    }

    function collectAllergies() {
        return [...document.querySelectorAll('input[name="allergy"]:checked')]
            .map(el => Number(el.value));
    }

    function renderAllergySelector(allergies) {
        const $wrap = $('#allergyCheckWrap');
        $wrap.empty();

        allergies.forEach(a => {
            $wrap.append(`
            <label class="allergy_check_item">
                <input type="checkbox" name="allergy" value="${a.allergyId}">
                <span>${a.allergyName}</span>
                <div class="allergy_icon"><i class="fas fa-check"></i></div>
            </label>
             `);
        });
    }

    function renderMaterialSelector(materials) {
        const $from = $('#optionFromMaterial');
        const $to   = $('#optionToMaterial');

        $from.empty().append('<option value="">선택하세요</option>');
        $to.empty().append('<option value="">선택하세요</option>');

        materials.forEach(m => {
            const opt = `<option value="${m.materialId}">${m.materialName}</option>`;
            $from.append(opt);
            $to.append(opt);
        });
    }

    // 전역 변수: 옵션 그룹 데이터 및 선택된 옵션
    window.optionGroupsData = [];
    window.selectedOptionsByGroup = {};
    window.currentOptionGroupIndex = null;

    function renderOptionSelector(optionGroups) {
        window.optionGroupsData = optionGroups;
        const $wrap = $('#productOptionGroupWrap');
        $wrap.empty();

        if (!optionGroups || optionGroups.length === 0) {
            $wrap.html('<div style="color: var(--gray-500); padding: 12px;">등록된 옵션이 없습니다.</div>');
            return;
        }

        let html = '<div class="option_group_btn_wrap">';
        optionGroups.forEach((group, index) => {
            html += `
                <div class="option_group_btn" data-group-index="${index}" data-group-name="${group.optionGroupName}">
                    <span class="option_group_btn_text">${group.optionGroupName}</span>
                    <i class="fas fa-chevron-right"></i>
                </div>`;
        });
        html += '</div>';
        $wrap.html(html);

        $('.option_group_btn').on('click', function() {
            const groupIndex = $(this).data('group-index');
            const groupName = $(this).data('group-name');
            openOptionSelectModal(groupIndex, groupName);
        });
    }

    function openOptionSelectModal(groupIndex, groupName) {
        window.currentOptionGroupIndex = groupIndex;
        const group = window.optionGroupsData[groupIndex];
        if (!group) return;

        $('#optionSelectModalTitle').text(groupName + ' 선택');

        const selectedIds = (window.selectedOptionsByGroup[groupName] || []).map(o => o.id);

        let html = '';
        group.options.forEach(opt => {
            const isSelected = selectedIds.includes(opt.optionId);
            const selectedClass = isSelected ? 'selected' : '';
            html += `
                <li class="option_select_item ${selectedClass}"
                    data-id="${opt.optionId}"
                    data-name="${opt.optionName}"
                    data-price="${opt.defaultPrice}"
                    data-group="${groupName}">
                    <span class="option_select_item_name">${opt.optionName} (+₩${Number(opt.defaultPrice).toLocaleString()})</span>
                    <div class="option_select_item_check"><i class="fas fa-check"></i></div>
                </li>`;
        });
        $('#optionSelectList').html(html);

        $('.option_select_item').on('click', function() {
            $(this).toggleClass('selected');
        });

        $('#optionSelectModal').addClass('active');
    }

    function closeOptionSelectModal() {
        $('#optionSelectModal').removeClass('active');
    }

    function confirmOptionSelection() {
        const groupIndex = window.currentOptionGroupIndex;
        const group = window.optionGroupsData[groupIndex];
        const groupName = group.optionGroupName;

        const selectedInGroup = [];
        $('#optionSelectList .option_select_item.selected').each(function() {
            selectedInGroup.push({
                id: $(this).data('id'),
                name: $(this).data('name'),
                price: $(this).data('price')
            });
        });

        window.selectedOptionsByGroup[groupName] = selectedInGroup;

        const $btn = $(`.option_group_btn[data-group-name="${groupName}"]`);
        if (selectedInGroup.length > 0) {
            const text = selectedInGroup.length > 1
                ? `${selectedInGroup[0].name} 외 ${selectedInGroup.length - 1}건`
                : selectedInGroup[0].name;
            $btn.find('.option_group_btn_text').text(text).addClass('selected');
        } else {
            $btn.find('.option_group_btn_text').text(groupName).removeClass('selected');
        }

        closeOptionSelectModal();
    }

    function collectSelectedOptionIds() {
        const ids = [];
        Object.values(window.selectedOptionsByGroup || {}).forEach(options => {
            options.forEach(opt => ids.push(opt.id));
        });
        return ids;
    }

    function renderCategorySelector(categories) {
        const $select = $('#productCategory');
        $select.empty();
        $select.append('<option value="">선택하세요</option>');

        categories.forEach(c => {
            $select.append(`<option value="${c.categoryName}">${c.categoryName}</option>`);
        });
    }

    async function loadSelectors() {
        const [opts, mats, alls, cats] = await Promise.all([
            fetch(OPTION_API).then(r => r.json()),
            fetch(MATERIAL_API).then(r => r.json()),
            fetch(ALLERGY_API).then(r => r.json()),
            fetch(CATEGORY_API).then(r => r.json())
        ]);

        renderOptionSelector(opts);
        renderMaterialSelector(mats);
        renderAllergySelector(alls);
        renderCategorySelector(cats);
    }

    $(document).ready(function () {
        loadSelectors();
        loadProductList(1);
    });

    $(document).ready(function () {
        $('.product_search_btn').on('click', () => searchProducts(1));

        $('.product_search_input').on('keyup', function (e) {
            if (e.key === 'Enter') {
                searchProducts(1);
            }
        });
    });

    function renderPagination(totalPages, currentPage) {
        const $wrap = $('.board_page ul');
        $wrap.empty();

        if (totalPages <= 1) return;

        $wrap.append(`
        <li>
            <a href="javascript:void(0)" onclick="loadProductList(1)">
                <span>처음</span>
            </a>
        </li>
    `);

        for (let i = 1; i <= totalPages; i++) {
            $wrap.append(`
            <li class="${i === currentPage ? 'board_page_check' : ''}">
                <a href="javascript:void(0)" onclick="loadProductList(${i})">
                    <span>${i}</span>
                </a>
            </li>
        `);
        }

        $wrap.append(`
        <li>
            <a href="javascript:void(0)" onclick="loadProductList(${totalPages})">
                <span>마지막</span>
            </a>
        </li>
    `);
    }
</script>
</body>
</html>
