<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>제품 관리 - TORI COFFEE</title>

    <!-- CSS -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@900&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;600;700;900&display=swap">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css">
    <link rel="stylesheet" href="https://img.79plus.co.kr/megahp/common/css/bootstrap.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://img.79plus.co.kr/megahp/common/css/simple-line-icons.min.css">
    <link rel="stylesheet" href="https://img.79plus.co.kr/megahp/common/css/style.css?ver=202508271051">
    <link rel="stylesheet" th:href="@{/v2/v2_theme.css}">
    <link rel="stylesheet" href="https://img.79plus.co.kr/megahp/common/css/animate.css">
    <link rel="stylesheet" href="https://img.79plus.co.kr/megahp/common/css/aos.css?ver=202508271045">

    <style>
        /* 헤더 고정 해제 - 스크롤 시 사라지도록 */
        .head_wrap {
            position: static !important;
            position: relative !important;
        }
        .head_wrap.head_fixed {
            position: static !important;
            position: relative !important;
        }
        .head_wrap .head {
            position: relative !important;
        }
        /* 로고 중복 방지 - 모든 가상 요소 및 배경 이미지 제거 */
        .head_wrap .head_logo,
        .head_wrap .head .head_logo {
            display: block !important;
            visibility: visible !important;
            position: relative !important;
            z-index: 1 !important;
            background: none !important;
            background-image: none !important;
        }
        .head_wrap .head_logo::before,
        .head_wrap .head_logo::after,
        .head_wrap .head .head_logo::before,
        .head_wrap .head .head_logo::after {
            display: none !important;
            content: "" !important;
            background: none !important;
            background-image: none !important;
        }
        .head_wrap .head_logo a,
        .head_wrap .head .head_logo a {
            display: block !important;
            background: none !important;
            background-image: none !important;
        }
        .head_wrap .head_logo a::before,
        .head_wrap .head_logo a::after,
        .head_wrap .head .head_logo a::before,
        .head_wrap .head .head_logo a::after {
            display: none !important;
            content: "" !important;
            background: none !important;
            background-image: none !important;
        }
        .head_wrap .head_logo img,
        .head_wrap .head .head_logo img {
            display: block !important;
            visibility: visible !important;
            max-height: 60px !important;
            height: auto !important;
            width: auto !important;
            position: relative !important;
            background: none !important;
            background-image: none !important;
        }
        .head_wrap .head_logo .head_logo_img,
        .head_wrap .head .head_logo .head_logo_img {
            display: block !important;
            visibility: visible !important;
        }
        /* 중복 로고 요소 숨기기 */
        .head_wrap .head_logo + .head_logo,
        .head_wrap .head .head_logo + .head_logo {
            display: none !important;
        }
        .head_user_wrap {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1000;
        }
        .head_user_menu {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .head_user_item {
            position: relative;
        }
        .head_user_link {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            color: #333;
            cursor: pointer;
            position: relative;
            padding: 5px 10px;
        }
        .head_user_link:hover {
            color: #000;
        }
        .head_user_link i {
            font-size: 20px;
            margin-bottom: 5px;
        }
        .head_user_text {
            font-size: 12px;
            font-weight: 400;
        }
        .head_login_wrap {
            position: relative;
        }
        .head_login_dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 10px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            min-width: 150px;
            display: none;
            z-index: 1001;
        }
        .head_login_wrap.active .head_login_dropdown {
            display: block;
        }
        .head_login_dropdown::before {
            content: '';
            position: absolute;
            top: -8px;
            right: 20px;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid #fff;
        }
        .head_login_dropdown ul {
            list-style: none;
            margin: 0;
            padding: 8px 0;
        }
        .head_login_dropdown ul li {
            margin: 0;
        }
        .head_login_dropdown ul li a {
            display: block;
            padding: 10px 20px;
            color: #333;
            text-decoration: none;
            font-size: 14px;
            transition: background 0.2s;
        }
        .head_login_dropdown ul li a:hover {
            background: #f5f5f5;
        }

        /* 제품 관리 스타일 */
        .admin_wrap {
            max-width: 100%;
            margin: 0 auto;
            padding: 0;
            background: #fff;
            min-height: calc(100vh - 200px);
            padding-top: 100px; /* 헤더 높이만큼 여백 추가 */
        }
        .admin_content_wrap {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        .admin_header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        .admin_title {
            font-size: 28px;
            font-weight: 700;
            color: #333;
        }
        .admin_nav {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .admin_nav_item {
            padding: 10px 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fff;
            color: #666;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }
        .admin_nav_item:hover {
            border-color: #333;
            color: #333;
        }
        .admin_nav_item.active {
            background: #333;
            color: #fff;
            border-color: #333;
        }

        /* 제품 관리 툴바 */
        .product_toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .product_search {
            display: flex;
            gap: 10px;
            flex: 1;
            min-width: 300px;
        }
        .product_search_input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }
        .product_search_btn {
            padding: 10px 20px;
            background: #333;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
        }
        .product_add_btn {
            padding: 10px 20px;
            background: #D95B3B;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
        }
        .product_add_btn:hover {
            background: #C74A2A;
        }
        .product_filter {
            display: flex;
            gap: 10px;
        }
        .product_filter_select {
            padding: 10px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            background: #fff;
        }

        /* 제품 목록 */
        .product_list_table {
            width: 100%;
            border-collapse: collapse;
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .product_list_table thead {
            background: #f9f9f9;
        }
        .product_list_table th {
            padding: 15px;
            text-align: left;
            font-size: 14px;
            font-weight: 700;
            color: #333;
            border-bottom: 2px solid #e0e0e0;
        }
        .product_list_table td {
            padding: 15px;
            font-size: 14px;
            color: #666;
            border-bottom: 1px solid #f0f0f0;
        }
        .product_list_table tbody tr:hover {
            background: #f9f9f9;
        }
        .product_image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
        }
        .product_action_btn {
            padding: 6px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background: #fff;
            color: #333;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 5px;
        }
        .product_action_btn:hover {
            background: #333;
            color: #fff;
            border-color: #333;
        }
        .product_action_btn.edit {
            background: #D95B3B;
            border-color: #D95B3B;
            color: #fff;
        }
        .product_action_btn.edit:hover {
            background: #C74A2A;
        }
        .product_action_btn.delete {
            background: #dc3545;
            border-color: #dc3545;
            color: #fff;
        }
        .product_action_btn.delete:hover {
            background: #c82333;
        }

        /* 제품 추가/수정 폼 */
        .product_form_wrap {
            background: #fff;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .product_form_header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        .product_form_title {
            font-size: 24px;
            font-weight: 700;
            color: #333;
        }
        .product_form_close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 5px;
        }
        .product_form_close:hover {
            color: #333;
        }
        .product_form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .product_form_row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .product_form_item {
            display: flex;
            flex-direction: column;
        }
        .product_form_label {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        .product_form_input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            box-sizing: border-box;
        }
        .product_form_input:focus {
            outline: none;
            border-color: #333;
        }
        .product_form_image_preview {
            width: 200px;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        .product_ingredient_wrap {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .product_ingredient_list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .product_ingredient_item {
            display: flex;
            gap: 10px;
            align-items: center;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        .product_ingredient_item select,
        .product_ingredient_item input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
        }
        .product_ingredient_item select {
            min-width: 150px;
        }
        .product_ingredient_item input {
            min-width: 100px;
        }
        .product_ingredient_remove_btn {
            padding: 8px 15px;
            background: #dc3545;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .product_ingredient_remove_btn:hover {
            background: #c82333;
        }
        .product_ingredient_add_btn {
            padding: 10px 15px;
            background: #333;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
            align-self: flex-start;
        }
        .product_ingredient_add_btn:hover {
            background: #555;
        }
        /* 옵션 설정 스타일 */
        .product_option_wrap {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .product_option_list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .product_option_item {
            display: flex;
            gap: 10px;
            align-items: center;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        .product_option_item input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
        }
        .product_option_item input[type="text"] {
            min-width: 150px;
        }
        .product_option_item input[type="number"] {
            min-width: 100px;
        }
        .product_option_remove_btn {
            padding: 8px 15px;
            background: #dc3545;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .product_option_remove_btn:hover {
            background: #c82333;
        }
        .product_option_add_btn {
            padding: 10px 15px;
            background: #D95B3B;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
            align-self: flex-start;
        }
        .product_option_add_btn:hover {
            background: #C74A2A;
        }
        .product_form_actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: flex-end;
        }
        .product_form_btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .product_form_btn.cancel {
            background: #fff !important;
            background-color: #fff !important;
            color: #666 !important;
            border: 2px solid #ddd !important;
        }
        .product_form_btn.cancel:hover {
            background: #f5f5f5 !important;
            background-color: #f5f5f5 !important;
        }
        .product_form_btn.save {
            background: #D95B3B;
            color: #fff;
        }
        .product_form_btn.save:hover {
            background: #C74A2A;
        }

        /* 제품 추가/수정 모달 */
        .product_modal_overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .product_modal_overlay.active {
            display: flex;
        }
        .product_modal {
            background: #fff;
            width: 100%;
            max-width: 600px;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            max-height: 90vh;
            overflow-y: auto;
        }
        .product_modal_header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        .product_modal_title {
            font-size: 20px;
            font-weight: 700;
            color: #333;
        }
        .product_modal_close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        .product_modal_form_item {
            margin-bottom: 20px;
        }
        .product_modal_label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        .product_modal_input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            box-sizing: border-box;
        }
        .product_modal_input:focus {
            outline: none;
            border-color: #333;
        }
        .product_modal_image_preview {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            margin-top: 10px;
            border: 1px solid #e0e0e0;
        }
        .product_modal_actions {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }
        .product_modal_btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .product_modal_btn.cancel {
            background: #f5f5f5;
            color: #666;
        }
        .product_modal_btn.cancel:hover {
            background: #e0e0e0;
        }
        .product_modal_btn.save {
            background: #D95B3B;
            color: #fff;
        }
        .product_modal_btn.save:hover {
            background: #C74A2A;
        }
        /* 영양정보 및 알레르기 스타일 */
        .product_info_section {
            margin-top: 20px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        .nutrition_grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        /* 알레르기 유발 성분 커스텀 체크박스 스타일 */
        .allergy_grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2열로 배치 */
            gap: 10px;
            margin-top: 15px;
        }

        .allergy_check_item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background: #fff;
        }

        .allergy_check_item:hover {
            border-color: #D95B3B;
            background: #fff9f7;
        }

        .allergy_check_item.selected {
            border-color: #D95B3B;
            background: #fff9f7;
        }

        .allergy_name {
            font-size: 15px;
            color: #333;
            font-weight: 500;
        }

        .allergy_icon {
            width: 20px;
            height: 20px;
            border: 2px solid #D95B3B;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .allergy_check_item.selected .allergy_icon {
            background: #D95B3B;
        }

        .allergy_check_item.selected .allergy_icon i {
            color: #fff;
            font-size: 11px;
            display: block;
        }

        .allergy_icon i {
            display: none;
        }

        /* 실제 체크박스는 숨김 처리 */
        .allergy_check_item input[type="checkbox"] {
            display: none;
        }

        /* 삭제 확인 모달 */
        .delete_modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            display: none;
            z-index: 10001;
            overflow: auto;
        }
        .delete_modal.show {
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }
        .delete_modal_content {
            background: #fff;
            border-radius: 12px;
            padding: 30px 25px 20px;
            max-width: 360px;
            width: calc(100% - 40px);
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            position: relative;
            margin: auto;
            transform: translateY(-60px);
        }
        .delete_modal_title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 16px;
            color: #333;
        }
        .delete_modal_text {
            font-size: 14px;
            color: #555;
            margin-bottom: 24px;
            line-height: 1.6;
        }
        .delete_modal_buttons {
            display: flex;
            gap: 10px;
        }
        .delete_modal_btn {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            border: none;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.2s;
        }
        .delete_modal_btn.cancel {
            background: #fff !important;
            background-color: #fff !important;
            color: #666 !important;
            border: 2px solid #ddd !important;
        }
        .delete_modal_btn.cancel:hover {
            background: #f5f5f5 !important;
            background-color: #f5f5f5 !important;
        }
        .delete_modal_btn.confirm {
            background: #D95B3B;
            color: #fff;
        }
        .delete_modal_btn.confirm:hover {
            background: #C74A2A;
        }
        .delete_modal_btn.close {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: none;
            background: #D95B3B !important;
            background-color: #D95B3B !important;
            background-image: none !important;
            color: #fff !important;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            opacity: 1 !important;
        }
        .delete_modal_btn.close:hover {
            background: #C74A2A !important;
            background-color: #C74A2A !important;
            opacity: 1 !important;
        }
        #editSuccessModal .delete_modal_btn.close,
        #deleteSuccessModal .delete_modal_btn.close,
        #addSuccessModal .delete_modal_btn.close {
            background: #D95B3B !important;
            background-color: #D95B3B !important;
            background-image: none !important;
            color: #fff !important;
            opacity: 1 !important;
        }
        #editSuccessModal .delete_modal_btn.close:hover,
        #deleteSuccessModal .delete_modal_btn.close:hover,
        #addSuccessModal .delete_modal_btn.close:hover {
            background: #C74A2A !important;
            background-color: #C74A2A !important;
            opacity: 1 !important;
        }

        @media (max-width: 768px) {
            .admin_header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            .product_toolbar {
                flex-direction: column;
            }
            .product_search {
                width: 100%;
            }
            .product_form_row {
                grid-template-columns: 1fr;
            }
            .product_list_table {
                font-size: 12px;
            }
            .product_list_table th,
            .product_list_table td {
                padding: 10px 8px;
            }
            .allergy_grid {
                grid-template-columns: 1fr; /* 모바일에서는 1열 */
            }
        }
    </style>

    <!-- JavaScript -->
    <script src="https://code.jquery.com/jquery.min.js"></script>
    <script src="https://img.79plus.co.kr/megahp/common/js/bootstrap.js"></script>
    <script src="https://img.79plus.co.kr/megahp/common/js/common.js?ver=202307100846"></script>
    <script src="https://img.79plus.co.kr/megahp/common/js/aos.js"></script>
</head>
<body>

<!-- 헤더 -->
<div class="head_wrap">
    <div class="head">
        <div class="head_logo">
            <a href="user.html">
                <img alt="TORI COFFEE 로고" class="head_logo_img" th:src="@{/logo/logo.png}">
            </a>
        </div>
        <div class="head_menu_wrap">
            <div class="head_menu">
                <ul>
                    <li>
                        <a href="user.html" class="pc">회원 관리</a>
                    </li>
                    <li>
                        <a href="product.html" class="pc">상품 관리</a>
                    </li>
                    <li>
                        <a href="notice.html" class="pc">공지사항 관리</a>
                    </li>
                    <li>
                        <a href="inquiry.html" class="pc">문의 관리</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="head_user_wrap">
            <div class="head_user_menu">
                <div class="head_user_item head_login_wrap">
                    <div class="head_login_state head_login_state_member">
                        <a href="#" class="head_user_link head_login_trigger">
                            <i class="far fa-user"></i>
                            <span class="head_user_text head_user_name">Admin</span>
                        </a>
                        <div class="head_login_dropdown">
                            <ul>
                                <li><a href="#" id="adminLogoutBtn">로그아웃</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 메인 콘텐츠 -->
<div class="admin_wrap">
    <div class="admin_content_wrap">
        <div class="admin_header">
            <div class="admin_title">제품 관리</div>
        </div>

        <!-- 네비게이션 -->
        <div class="admin_nav">
            <a href="user.html" class="admin_nav_item">회원 관리</a>
            <a href="product.html" class="admin_nav_item active">상품 관리</a>
            <a href="notice.html" class="admin_nav_item">공지사항 관리</a>
            <a href="inquiry.html" class="admin_nav_item">문의 관리</a>
        </div>

        <!-- 검색 및 필터 -->
        <div class="product_toolbar">
            <div class="product_search">
                <input type="text" class="product_search_input" placeholder="제품명으로 검색...">
                <button class="product_search_btn">검색</button>
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="product_add_btn" onclick="showAddForm()">
                    <i class="fas fa-plus"></i> 제품 추가
                </button>
            </div>
        </div>

        <!-- 제품 추가/수정 폼 -->
        <div class="product_form_wrap" id="productFormWrap" style="display: none;">
            <div class="product_form_header">
                <div class="product_form_title" id="productFormTitle">제품 추가</div>
                <button class="product_form_close" onclick="hideProductForm()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="productForm" class="product_form">
                <div class="product_form_row">
                    <div class="product_form_item">
                        <label class="product_form_label">제품명</label>
                        <input type="text" class="product_form_input" id="productName" required>
                    </div>
                    <div class="product_form_item">
                        <label class="product_form_label">카테고리</label>
                        <select class="product_form_input" id="productCategory" required>
                            <option value="">선택하세요</option>
                            <option value="음료" selected>음료</option>
                        </select>
                    </div>
                </div>
                <div class="product_form_row">
                    <div class="product_form_item">
                        <label class="product_form_label">가격</label>
                        <input type="number" class="product_form_input" id="productPrice" required min="0" placeholder="가격을 입력하세요">
                    </div>
                    <div class="product_form_item">
                        <label class="product_form_label">이미지</label>
                        <input type="file" class="product_form_input" id="productImage" accept="image/*" onchange="previewImage(this)">
                    </div>
                </div>
                <div class="product_form_row">
                    <div class="product_form_item" style="grid-column: 1 / -1;">
                        <label class="product_form_label">상세설명</label>
                        <textarea class="product_form_input" id="productDescription" rows="4" placeholder="상품 상세설명을 입력하세요"></textarea>
                    </div>
                </div>
                <div class="product_form_row" id="productImagePreviewRow" style="display: none;">
                    <div class="product_form_item">
                        <label class="product_form_label">이미지 미리보기</label>
                        <img id="productImagePreview" class="product_form_image_preview" alt="미리보기">
                    </div>
                </div>
                <div class="product_form_row">
                    <div class="product_form_item" style="grid-column: 1 / -1;">
                        <label class="product_form_label">옵션 설정 (등록된 옵션 선택)</label>
                        <div class="product_option_wrap">
                            <!-- 등록된 옵션 선택 영역 -->
                            <div id="productOptionGroupWrap" style="margin-bottom: 15px;">
                                <!-- renderOptionSelector()가 여기에 렌더링 -->
                            </div>
                            <!-- 직접 추가한 옵션 리스트 -->
                            <div class="product_option_list" id="productOptionList">
                            </div>
                            <!-- 기존 버튼 -->
                            <button type="button"
                                    class="product_option_add_btn"
                                    onclick="addOptionItem()">
                                <i class="fas fa-plus"></i> 옵션 추가
                            </button>

                        </div>
                    </div>
                </div>

                <div class="product_info_section" style="margin-top:20px; padding:20px; background:#f9f9f9; border-radius:8px;">
                    <label class="product_form_label"><i class="fas fa-info-circle"></i> 영양 상세정보 (1회 제공량 기준)</label>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-top:10px;">
                        <div class="product_form_item">
                            <label style="font-size:12px;">칼로리 (kcal)</label>
                            <input type="number" class="product_form_input" id="nutri_cal">
                        </div>
                        <div class="product_form_item">
                            <label style="font-size:12px;">나트륨 (mg)</label>
                            <input type="number" class="product_form_input" id="nutri_sodium">
                        </div>
                        <div class="product_form_item">
                            <label style="font-size:12px;">탄수화물 (g)</label>
                            <input type="number" class="product_form_input" id="nutri_carbo">
                        </div>
                        <div class="product_form_item">
                            <label style="font-size:12px;">당류 (g)</label>
                            <input type="number" class="product_form_input" id="nutri_sugar">
                        </div>
                        <div class="product_form_item">
                            <label style="font-size:12px;">단백질 (g)</label>
                            <input type="number" class="product_form_input" id="nutri_protein">
                        </div>
                        <div class="product_form_item">
                            <label style="font-size:12px;">지방 (g)</label>
                            <input type="number" class="product_form_input" id="nutri_fat">
                        </div>
                        <div class="product_form_item">
                            <label style="font-size:12px;">포화지방 (g)</label>
                            <input type="number" class="product_form_input" id="nutri_s_fat">
                        </div>
                        <div class="product_form_item">
                            <label style="font-size:12px;">카페인 (mg)</label>
                            <input type="number" class="product_form_input" id="nutri_caffeine">
                        </div>
                    </div>
                </div>

                <div class="product_info_section">
                    <label class="product_form_label"><i class="fas fa-exclamation-triangle"></i> 알레르기 유발 요인</label>
                    <div style="font-size: 13px; color: #999; margin-bottom: 15px;">해당되는 성분을 모두 선택해주세요.</div>

                    <div class="allergy_grid" id="allergyCheckWrap"></div>
                </div>

                <div class="product_form_row">
                    <div class="product_form_item" style="grid-column: 1 / -1;">
                        <label class="product_form_label">원재료</label>
                        <div class="product_ingredient_wrap">
                            <div class="product_ingredient_list" id="productIngredientList">
                                <!-- 원재료 항목들이 여기에 동적으로 추가됩니다 -->
                            </div>
                            <button type="button" class="product_ingredient_add_btn" onclick="addIngredientItem()">
                                <i class="fas fa-plus"></i> 원재료 추가
                            </button>
                        </div>
                    </div>
                </div>
                <div class="product_form_actions">
                    <button type="button" class="product_form_btn cancel" onclick="hideProductForm()">취소</button>
                    <button type="submit" class="product_form_btn save">저장</button>
                </div>
            </form>
        </div>

        <!-- 제품 목록 -->
        <div class="cont_text_wrap" id="productListWrap">
            <table class="product_list_table">
                <thead>
                <tr>
                    <th>이미지</th>
                    <th>제품명</th>
                    <th>카테고리</th>
                    <th>가격</th>
                    <th>등록일</th>
                    <th>관리</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td><img src="https://via.placeholder.com/60" alt="제품" class="product_image"></td>
                    <td>아메리카노</td>
                    <td>음료</td>
                    <td>₩4,000</td>
                    <td>2024-01-01</td>
                    <td>
                        <button class="product_action_btn edit" onclick="editProduct(1)">수정</button>
                        <button class="product_action_btn delete" onclick="deleteProduct(1)">삭제</button>
                    </td>
                </tr>
                <tr>
                    <td><img src="https://via.placeholder.com/60" alt="제품" class="product_image"></td>
                    <td>카페라떼</td>
                    <td>음료</td>
                    <td>₩4,500</td>
                    <td>2024-01-01</td>
                    <td>
                        <button class="product_action_btn edit" onclick="editProduct(2)">수정</button>
                        <button class="product_action_btn delete" onclick="deleteProduct(2)">삭제</button>
                    </td>
                </tr>
                <tr>
                    <td><img src="https://via.placeholder.com/60" alt="제품" class="product_image"></td>
                    <td>바닐라라떼</td>
                    <td>음료</td>
                    <td>₩4,500</td>
                    <td>2024-01-05</td>
                    <td>
                        <button class="product_action_btn edit" onclick="editProduct(3)">수정</button>
                        <button class="product_action_btn delete" onclick="deleteProduct(3)">삭제</button>
                    </td>
                </tr>
                <tr>
                    <td><img src="https://via.placeholder.com/60" alt="제품" class="product_image"></td>
                    <td>카푸치노</td>
                    <td>음료</td>
                    <td>₩4,500</td>
                    <td>2024-01-10</td>
                    <td>
                        <button class="product_action_btn edit" onclick="editProduct(4)">수정</button>
                        <button class="product_action_btn delete" onclick="deleteProduct(4)">삭제</button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- 페이지네이션 -->
        <div class="board_page_wrap">
            <div class="board_page">
                <ul>
                    <li><a><span>처음</span></a></li>
                    <li class="board_page_check"><a><span>1</span></a></li>
                    <li><a><span>2</span></a></li>
                    <li><a><span>다음</span></a></li>
                    <li><a><span>마지막</span></a></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- 푸터 -->
<div class="foot_menu_wrap">
    <div class="foot_menu">
        <div class="cont_list">
            <ul>
                <li><a class="modal_open modal_open_policy1"><b>이용약관</b></a></li>
                <li><a href="/common/policy/privacy_policy.php"><b>개인정보처리방침</b></a></li>
                <li><a href="/common/policy/service_policy.php"><b>멤버십 이용약관</b></a></li>
            </ul>
        </div>
    </div>
</div>
<div class="foot_wrap">
    <div class="foot">
        <div class="cont_list cont_list_content">
            <ul>
                <li>
                    <div class="cont_text">
                        <div class="cont_list cont_list_m cont_list_m1">
                            <ul>
                                <li>
                                    <div class="foot_logo">
                                        <img alt="TORI COFFEE 로고" th:src="@{/logo/logo.png}">
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="cont_text foot_info">
                        <div class="cont_list cont_list_small cont_list_width_m">
                            <ul>
                                <li><b>주식회사 앤하우스</b></li>
                                <li>대표자 김대영</li>
                                <li>창업상담 1588-0656</li>
                                <li>고객센터 1588-8298</li>
                                <li>FAX 02-325-5199</li>
                                <li>사업자등록번호 105-87-51367</li>
                                <li>서울특별시 강남구 강남대로 518 11층, 13층 (주)앤하우스</li>
                                <li>개인정보보호 책임자 이종원</li>
                            </ul>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>

<!-- 상단 이동 버튼 -->
<a href="javascript:go_top()">
    <div class="go_top_wrap">
        <div class="go_top"></div>
    </div>
</a>

<!-- 제품 추가/수정 모달 -->
<div class="product_modal_overlay" id="productModal">
    <div class="product_modal">
        <div class="product_modal_header">
            <div class="product_modal_title" id="productModalTitle">제품 추가</div>
            <button class="product_modal_close" onclick="closeProductModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form id="productForm">
            <div class="product_modal_form_item">
                <label class="product_modal_label">제품명</label>
                <input type="text" class="product_modal_input" id="productName" required>
            </div>
            <div class="product_modal_form_item">
                <label class="product_modal_label">카테고리</label>
                <select class="product_modal_input" id="productCategory" required>
                    <option value="">선택하세요</option>
                    <option value="음료" selected>음료</option>
                </select>
            </div>
            <div class="product_modal_form_item">
                <label class="product_modal_label">가격</label>
                <input type="number" class="product_modal_input" id="productPrice" required min="0" placeholder="가격을 입력하세요">
            </div>
            <div class="product_modal_form_item">
                <label class="product_modal_label">상세설명</label>
                <textarea class="product_modal_input" id="productDescription" rows="4" placeholder="상품 상세설명을 입력하세요"></textarea>
            </div>
            <div class="product_modal_form_item">
                <label class="product_modal_label">옵션 설정</label>
                <div class="product_option_wrap">
                    <div class="product_option_list" id="productOptionListModal">
                        <!-- 옵션 항목들이 여기에 동적으로 추가됩니다 -->
                    </div>
                    <button type="button" class="product_option_add_btn" onclick="addOptionItemModal()">
                        <i class="fas fa-plus"></i> 옵션 그룹 추가
                    </button>
                </div>
            </div>
            <div class="product_modal_form_item">
                <label class="product_modal_label">이미지</label>
                <input type="file" class="product_modal_input" id="productImage" accept="image/*" onchange="previewImage(this)">
                <img id="productImagePreview" class="product_modal_image_preview" style="display: none;" alt="미리보기">
            </div>
            <div class="product_modal_actions">
                <button type="button" class="product_modal_btn cancel" onclick="closeProductModal()">취소</button>
                <button type="submit" class="product_modal_btn save">저장</button>
            </div>
        </form>
    </div>
</div>

<!-- 삭제 확인 모달 -->
<div class="delete_modal" id="deleteModal">
    <div class="delete_modal_content">
        <div class="delete_modal_title">삭제 확인</div>
        <div class="delete_modal_text">
            정말 삭제하시겠습니까?
        </div>
        <div class="delete_modal_buttons">
            <button type="button" class="delete_modal_btn cancel" onclick="closeDeleteModal()">취소</button>
            <button type="button" class="delete_modal_btn confirm" onclick="confirmDelete()">확인</button>
        </div>
    </div>
</div>

<!-- 삭제 완료 모달 -->
<div class="delete_modal" id="deleteSuccessModal">
    <div class="delete_modal_content">
        <div class="delete_modal_title">완료</div>
        <div class="delete_modal_text">
            제품이 삭제되었습니다.
        </div>
        <button type="button" class="delete_modal_btn close" onclick="closeDeleteSuccessModal()" style="background: #D95B3B !important; background-color: #D95B3B !important; background-image: none !important; color: #fff !important; opacity: 1 !important; border: none !important;">확인</button>
    </div>
</div>

<!-- 수정 완료 모달 -->
<div class="delete_modal" id="editSuccessModal">
    <div class="delete_modal_content">
        <div class="delete_modal_title">완료</div>
        <div class="delete_modal_text">
            제품 정보가 수정되었습니다.
        </div>
        <button type="button" class="delete_modal_btn close" onclick="closeEditSuccessModal()" style="background: #D95B3B !important; background-color: #D95B3B !important; background-image: none !important; color: #fff !important; opacity: 1 !important; border: none !important;">확인</button>
    </div>
</div>

<!-- 추가 완료 모달 -->
<div class="delete_modal" id="addSuccessModal">
    <div class="delete_modal_content">
        <div class="delete_modal_title">완료</div>
        <div class="delete_modal_text">
            제품이 추가되었습니다.
        </div>
        <button type="button" class="delete_modal_btn close" id="addSuccessModalBtn" onclick="closeAddSuccessModal()" style="background: #D95B3B !important; background-color: #D95B3B !important; background-image: none !important; color: #fff !important; opacity: 1 !important; border: none !important; border-color: #D95B3B !important;">확인</button>
    </div>
</div>

<script>
    AOS.init({
        duration: 1200,
    });

    const PRODUCT_API  = 'http://localhost:8000/api/admin/products';
    const OPTION_API   = 'http://localhost:8000/api/admin/options';
    const MATERIAL_API = 'http://localhost:8000/api/admin/materials';
    const ALLERGY_API  = 'http://localhost:8000/api/admin/allergies';

    let currentPage = 1;
    const PAGE_SIZE = 10;
    let editingMenuCode = null;

    async function loadProductList(page = 1) {
        const res = await fetch(`${PRODUCT_API}?page=${page}&limit=${PAGE_SIZE}`);
        const data = await res.json();

        const tbody = document.querySelector('.product_list_table tbody');
        tbody.innerHTML = '';

        data.content.forEach(p => {
            tbody.innerHTML += `
        <tr>
            <td><img src="${p.imageUrl || 'resources/static/src/no-image.png'}" class="product_image"></td>
            <td>${p.menuName}</td>
            <td>${p.category}</td>
            <td>₩${p.basePrice ? Number(p.basePrice).toLocaleString() : '-'}</td>
            <td>${p.createdAt ?? '-'}</td>
            <td>
                <button class="product_action_btn edit" onclick="openEditProduct(${p.menuCode})">수정</button>
                <button class="product_action_btn delete" onclick="deleteProduct(${p.menuCode})">삭제</button>
            </td>
        </tr>`;
        });

        renderPagination(data.totalPages, page);
    }

    async function searchProducts(page = 1) {
        const keyword = document.querySelector('.product_search_input').value.trim();

        if (!keyword) {
            loadProductList(1);
            return;
        }

        const res = await fetch(
            `${PRODUCT_API}/search?keyword=${encodeURIComponent(keyword)}&page=${page}&limit=${PAGE_SIZE}`
        );
        const data = await res.json();

        const tbody = document.querySelector('.product_list_table tbody');
        tbody.innerHTML = '';

        data.content.forEach(p => {
            tbody.innerHTML += `
        <tr>
            <td><img src="${p.imageUrl ?? 'https://via.placeholder.com/60'}" class="product_image"></td>
            <td>${p.menuName}</td>
            <td>${p.category}</td>
            <td>₩${Number(p.basePrice).toLocaleString()}</td>
            <td>-</td>
            <td>
                <button class="product_action_btn edit" onclick="openEditProduct(${p.menuCode})">수정</button>
                <button class="product_action_btn delete" onclick="deleteProduct(${p.menuCode})">삭제</button>
            </td>
        </tr>`;
        });

        renderPagination(data.totalPages, page);
    }


    // 권한 체크
    $(document).ready(function() {
        // var userRole = localStorage.getItem('userRole');
        // if (userRole !== 'admin') {
        //     alert('관리자 권한이 필요합니다.');
        //     window.location.href = 'login.html';
        //     return;
        // }

        // 사용자명 표시
        var userName = localStorage.getItem('userName') || 'Admin';
        $('.head_user_name').text(userName);

        // 로그인 드롭다운 토글
        $('.head_login_trigger').click(function(e) {
            e.preventDefault();
            e.stopPropagation();
            $('.head_login_wrap').toggleClass('active');
        });

        $(document).click(function(e) {
            if (!$(e.target).closest('.head_login_wrap').length) {
                $('.head_login_wrap').removeClass('active');
            }
        });

        // 로그아웃 버튼
        $('#adminLogoutBtn').on('click', function(e) {
            e.preventDefault();
            if (confirm('로그아웃하시겠습니까?')) {
                localStorage.clear();
                window.location.href = 'login.html';
            }
        });

        // 알레르기 커스텀 체크박스 제어
        $(document).on('change', '.allergy_check_item input[type="checkbox"]', function() {
            if ($(this).is(':checked')) {
                $(this).closest('.allergy_check_item').addClass('selected');
            } else {
                $(this).closest('.allergy_check_item').removeClass('selected');
            }
        });
    });

    // 옵션 항목 추가 (인라인 폼)
    let optionCounter = 0;

    function addOptionItem() {
        optionCounter++;
        // DB에서 불러올 옵션 목록 (예시)
        const options = [
            {id: 1, name: "샷 추가", basePrice: 500},
            {id: 2, name: "휘핑 추가", basePrice: 600},
            {id: 3, name: "사이즈 업(L)", basePrice: 1000}
        ];

        let selectHtml = `<div class="product_option_item" id="opt_${optionCounter}" style="display:flex; gap:10px; margin-bottom:10px;">
                <select class="product_form_input" style="flex:1;">
                    <option value="">적용할 옵션 선택</option>`;

        options.forEach(opt => {
            selectHtml += `<option value="${opt.id}">${opt.name} (+₩${opt.basePrice})</option>`;
        });

        selectHtml += `</select>
                <button type="button" class="product_option_remove_btn" onclick="$('#opt_${optionCounter}').remove()">삭제</button>
            </div>`;

        $('#productOptionList').append(selectHtml);
    }
    function hideProductForm() {
        $('#productFormWrap').slideUp();
        $('#productListWrap').show();
        $('#productForm')[0].reset(); // input, checkbox 모두 초기화
        $('#productImagePreviewRow').hide();
        $('#productIngredientList').empty();
        $('#productOptionList').empty();
        // 알레르기 체크박스 초기화
        $('.allergy_check_item').removeClass('selected');
        $('.allergy_check_item input[type="checkbox"]').prop('checked', false);
        ingredientCounter = 0;
        optionCounter = 0;
    }

    // 옵션 항목 추가 (모달)
    let optionCounterModal = 0;
    function addOptionItemModal() {
        optionCounterModal++;
        const optionItem = `
                <div class="product_option_item" data-option-id="${optionCounterModal}">
                    <input type="text" class="product_option_group_name" placeholder="옵션 그룹명 (예: 사이즈, 토핑)" required>
                    <input type="number" class="product_option_price" placeholder="추가 금액" required min="0" step="100">
                    <button type="button" class="product_option_remove_btn" onclick="removeOptionItemModal(${optionCounterModal})">삭제</button>
                </div>
            `;
        $('#productOptionListModal').append(optionItem);
    }

    // 옵션 항목 삭제 (인라인 폼)
    function removeOptionItem(id) {
        $(`.product_option_item[data-option-id="${id}"]`).remove();
    }

    // 옵션 항목 삭제 (모달)
    function removeOptionItemModal(id) {
        $(`.product_option_item[data-option-id="${id}"]`).remove();
    }

    // 원재료 항목 추가
    let ingredientCounter = 0;
    function addIngredientItem() {
        ingredientCounter++;
        const ingredientItem = `
                <div class="product_ingredient_item" data-ingredient-id="${ingredientCounter}">
                    <select class="product_ingredient_select" required>
                        <option value="">원재료 선택</option>
                        <option value="아메리카노 원두">아메리카노 원두</option>
                        <option value="라떼 원두">라떼 원두</option>
                        <option value="우유">우유</option>
                        <option value="시럽">시럽</option>
                        <option value="바닐라 시럽">바닐라 시럽</option>
                        <option value="카라멜 시럽">카라멜 시럽</option>
                        <option value="헤이즐넛 시럽">헤이즐넛 시럽</option>
                    </select>
                    <input type="number" class="product_ingredient_amount" placeholder="수량" required min="0" step="0.1">
                    <select class="product_ingredient_unit" required>
                        <option value="kg">kg</option>
                        <option value="L">L</option>
                        <option value="병">병</option>
                        <option value="개">개</option>
                        <option value="g">g</option>
                        <option value="ml">ml</option>
                    </select>
                    <button type="button" class="product_ingredient_remove_btn" onclick="removeIngredientItem(${ingredientCounter})">삭제</button>
                </div>
            `;
        $('#productIngredientList').append(ingredientItem);
    }

    // 원재료 항목 삭제
    function removeIngredientItem(id) {
        $(`.product_ingredient_item[data-ingredient-id="${id}"]`).remove();
    }

    // 제품 추가 폼 표시
    function showAddForm() {
        $('#productForm')[0].reset();
        $('#productFormTitle').text('제품 추가');
        $('#productImagePreviewRow').hide();
        $('#productIngredientList').empty();
        $('#productOptionList').empty();
        // 알레르기 체크박스 초기화
        $('.allergy_check_item').removeClass('selected');
        $('.allergy_check_item input[type="checkbox"]').prop('checked', false);
        ingredientCounter = 0;
        optionCounter = 0;
        $('#productForm').data('productId', null);
        $('#productFormWrap').slideDown();
        $('#productListWrap').hide();
        $('html, body').animate({ scrollTop: $('.product_form_wrap').offset().top - 100 }, 300);
    }

    function fillNutrition(data) {
        if (!data) return;

        $('#nutri_cal').val(data.calories ?? '');
        $('#nutri_sodium').val(data.sodium ?? '');
        $('#nutri_carbo').val(data.carbs ?? '');
        $('#nutri_sugar').val(data.sugars ?? '');
        $('#nutri_protein').val(data.protein ?? '');
        $('#nutri_fat').val(data.fat ?? '');
        $('#nutri_s_fat').val(data.saturatedFat ?? '');
        $('#nutri_caffeine').val(data.caffeine ?? '');
    }

    function fillAllergies(allergyIds) {
        if (!Array.isArray(allergyIds)) return;

        $('input[name="allergy"]').each(function () {
            const id = Number(this.value);
            const checked = allergyIds.includes(id);

            $(this).prop('checked', checked)
                .closest('.allergy_check_item')
                .toggleClass('selected', checked);
        });
    }

    function fillOptions(optionIds) {
        if (!Array.isArray(optionIds)) return;

        $('input[name="option"]').each(function () {
            const id = Number(this.value);
            const checked = optionIds.includes(id);

            $(this).prop('checked', checked)
                .closest('.allergy_check_item')
                .toggleClass('selected', checked);
        });
    }

    function fillIngredients(ingredients) {
        if (!ingredients) return;

        $('#productIngredientList').empty();
        ingredientCounter = 0;

        ingredients.forEach(i => {
            ingredientCounter++;

            $('#productIngredientList').append(`
            <div class="product_ingredient_item" data-ingredient-id="${ingredientCounter}">
                <select class="product_ingredient_select">
                    <option value="${i.name}" selected>${i.name}</option>
                </select>
                <input type="number" class="product_ingredient_amount" value="${i.amount}">
                <select class="product_ingredient_unit">
                    <option value="${i.unit}" selected>${i.unit}</option>
                </select>
            </div>
        `);
        });
    }



    // 제품 수정 폼 표시
    async function openEditProduct(menuCode) {
        const res = await fetch(`${PRODUCT_API}/${menuCode}`);
        const data = await res.json();

        editingMenuCode = menuCode;

        showAddForm();
        await loadSelectors();

        $('#productName').val(data.menuName);
        $('#productCategory').val(data.category);
        $('#productPrice').val(data.basePrice);
        $('#productDescription').val(data.description);

        fillNutrition(data);
        fillOptions(data.optionIds);
        fillIngredients(data.ingredients);
        fillAllergies(data.allergyIds);
    }


    // 제품 폼 숨기기
    function hideProductForm() {
        $('#productFormWrap').slideUp();
        $('#productListWrap').show();
        $('#productForm')[0].reset();
        $('#productImagePreviewRow').hide();
        $('#productIngredientList').empty();
        $('#productOptionList').empty();
        // 알레르기 체크박스 초기화
        $('.allergy_check_item').removeClass('selected');
        $('.allergy_check_item input[type="checkbox"]').prop('checked', false);
        ingredientCounter = 0;
        optionCounter = 0;
    }

    // 이미지 미리보기
    function previewImage(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                $('#productImagePreview').attr('src', e.target.result);
                $('#productImagePreviewRow').show();
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    // 제품 삭제
    let deleteProductId = null;
    function deleteProduct(id) {
        deleteProductId = id;
        $('#deleteModal').addClass('show');
    }

    // 삭제 확인
    async function confirmDelete() {
        if (!deleteProductId) return;

        await fetch(`${PRODUCT_API}/${deleteProductId}`, {
            method: 'DELETE'
        });

        closeDeleteModal();
        loadProductList(currentPage);
    }


    function closeDeleteModal() {
        $('#deleteModal').removeClass('show');
        deleteProductId = null;
    }

    function closeDeleteSuccessModal() {
        $('#deleteSuccessModal').removeClass('show');
        document.body.style.overflow = '';
        document.body.style.paddingRight = '';
        location.reload();
    }

    function closeEditSuccessModal() {
        $('#editSuccessModal').removeClass('show');
        document.body.style.overflow = '';
        document.body.style.paddingRight = '';
        location.reload();
    }

    function closeAddSuccessModal() {
        $('#addSuccessModal').removeClass('show');
        document.body.style.overflow = '';
        document.body.style.paddingRight = '';
        location.reload();
    }

    // 스크롤바 너비 계산
    function getScrollbarWidth() {
        const outer = document.createElement('div');
        outer.style.visibility = 'hidden';
        outer.style.overflow = 'scroll';
        outer.style.msOverflowStyle = 'scrollbar';
        document.body.appendChild(outer);
        const scrollbarWidth = outer.offsetWidth - outer.clientWidth;
        outer.parentNode.removeChild(outer);
        return scrollbarWidth;
    }

    // 제품 폼 제출
    $(document).ready(function() {
        document.getElementById('productForm').addEventListener('submit', async e => {
            e.preventDefault();

            const payload = {
                menuName: $('#productName').val(),
                category: $('#productCategory').val(),
                basePrice: Number($('#productPrice').val()),
                description: $('#productDescription').val(),

                optionIds: collectSelectedOptionIds(),   // ✅ 등록 옵션
                customOptions: collectCustomOptions(),   // ✅ 직접 옵션

                ingredients: collectIngredients(),
                allergyIds: collectAllergies(),
                nutrition: collectNutrition()

            };

            const url = editingMenuCode
                ? `${PRODUCT_API}/${editingMenuCode}`
                : PRODUCT_API;

            const method = editingMenuCode ? 'PUT' : 'POST';

            await fetch(url, {
                method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            editingMenuCode = null;
            hideProductForm();
            loadProductList(currentPage);
        });


        // 모달 외부 클릭 시 닫기
        $(document).on('click', '.delete_modal', function(e) {
            if ($(e.target).hasClass('delete_modal')) {
                closeDeleteModal();
                closeDeleteSuccessModal();
                closeEditSuccessModal();
                closeAddSuccessModal();
            }
        });

        // 제품 모달 닫기
        function closeProductModal() {
            $('#productModal').removeClass('active');
            $('#productOptionListModal').empty();
            optionCounterModal = 0;
        }

        // 재료 목록 로드
        function loadMaterialList() {
            // API 호출 (실제로는 서버에서 가져와야 함)
            // GET /api/admin/inventory 또는 GET /api/owner/inventory
            $.ajax({
                url: '/api/admin/inventory',
                method: 'GET',
                success: function(response) {
                    if (response.success && response.data) {
                        let optionsHtml = '<option value="">선택하세요</option>';
                        response.data.forEach(function(material) {
                            optionsHtml += '<option value="' + material.ingredient_id + '">' + material.ingredient_name + '</option>';
                        });
                        $('#optionFromMaterial').html(optionsHtml);
                        $('#optionToMaterial').html(optionsHtml);
                    }
                },
                error: function() {
                    // 에러 시 예시 데이터
                    const exampleMaterials = [
                        { ingredient_id: 1, ingredient_name: '아메리카노 원두' },
                        { ingredient_id: 2, ingredient_name: '라떼 원두' },
                        { ingredient_id: 3, ingredient_name: '우유' },
                        { ingredient_id: 4, ingredient_name: '시럽' }
                    ];
                    let optionsHtml = '<option value="">선택하세요</option>';
                    exampleMaterials.forEach(function(material) {
                        optionsHtml += '<option value="' + material.ingredient_id + '">' + material.ingredient_name + '</option>';
                    });
                    $('#optionFromMaterial').html(optionsHtml);
                    $('#optionToMaterial').html(optionsHtml);
                }
            });
        }

        function collectNutrition() {
            return {
                calories: Number($('#nutri_cal').val()) || 0,
                sodium: Number($('#nutri_sodium').val()) || 0,
                carbs: Number($('#nutri_carbo').val()) || 0,
                sugars: Number($('#nutri_sugar').val()) || 0,
                protein: Number($('#nutri_protein').val()) || 0,
                fat: Number($('#nutri_fat').val()) || 0,
                saturatedFat: Number($('#nutri_s_fat').val()) || 0,
                caffeine: Number($('#nutri_caffeine').val()) || 0
            };
        }

        function collectSelectedOptionIds() {
            return [...document.querySelectorAll('input[name="option"]:checked')]
                .map(el => Number(el.value));
        }

        function collectCustomOptions() {
            return [...document.querySelectorAll('#productOptionList .product_option_item')]
                .map(el => ({
                    optionId: el.querySelector('select')?.value || null
                }))
                .filter(o => o.optionId);
        }

        function collectIngredients() {
            return [...document.querySelectorAll('.product_ingredient_item')].map(el => ({
                name: el.querySelector('.product_ingredient_select').value,
                amount: Number(el.querySelector('.product_ingredient_amount').value),
                unit: el.querySelector('.product_ingredient_unit').value
            }));
        }

        function collectAllergies() {
            return [...document.querySelectorAll('input[name="allergy"]:checked')]
                .map(el => el.value);
        }

        // 옵션 등록 폼 제출
        $('#optionRegisterForm').on('submit', function(e) {
            e.preventDefault();

            const optionGroupName = $('#optionGroupName').val();
            const optionName = $('#optionName').val();
            const defaultPrice = $('#optionDefaultPrice').val();
            const processMethod = $('#optionProcessMethod').val();
            const quantity = $('#optionQuantity').val();
            const fromMaterialId = $('#optionFromMaterial').val() || null;
            const toMaterialId = $('#optionToMaterial').val() || null;

            if (!optionGroupName || !optionName || !defaultPrice || !processMethod || !quantity) {
                alert('필수 항목을 모두 입력해주세요.');
                return false;
            }

            if (processMethod === '변경' && !fromMaterialId) {
                alert('변경 전 재료를 선택해주세요.');
                return false;
            }

            if ((processMethod === '추가' || processMethod === '변경') && !toMaterialId) {
                alert('변경 후 재료를 선택해주세요.');
                return false;
            }

            // API 호출 (실제로는 서버에 요청)
            // POST /api/admin/options
            $.ajax({
                url: '/api/admin/options',
                method: 'POST',
                data: JSON.stringify({
                    option_group_name: optionGroupName,
                    option_name: optionName,
                    default_price: defaultPrice,
                    process_method: processMethod,
                    quantity: quantity,
                    from_material_id: fromMaterialId,
                    to_material_id: toMaterialId
                }),
                contentType: 'application/json',
                success: function(response) {
                    closeOptionRegisterModal();
                    alert('옵션이 등록되었습니다.');
                    // 페이지 새로고침 또는 옵션 목록 업데이트
                    location.reload();
                },
                error: function(xhr, status, error) {
                    console.error('옵션 등록 실패:', error);
                    alert('옵션 등록에 실패했습니다.');
                }
            });

            return false;
        });

        // 옵션 등록 모달 외부 클릭 시 닫기
        $(document).on('click', '#optionRegisterModal', function(e) {
            if ($(e.target).hasClass('product_modal_overlay')) {
                closeOptionRegisterModal();
            }
        });
    });

    function renderAllergySelector(allergies) {
        const $wrap = $('#allergyCheckWrap'); // ⭐ HTML에 있는 컨테이너 ID
        $wrap.empty();

        allergies.forEach(a => {
            $wrap.append(`
            <label class="allergy_check_item">
                <input type="checkbox" name="allergy" value="${a.allergyId}">
                <span>${a.allergyName}</span>
            </label>
        `);
        });
    }

    function renderMaterialSelector(materials) {
        const $from = $('#optionFromMaterial');
        const $to   = $('#optionToMaterial');

        $from.empty().append('<option value="">선택하세요</option>');
        $to.empty().append('<option value="">선택하세요</option>');

        materials.forEach(m => {
            const opt = `<option value="${m.materialId}">${m.materialName}</option>`;
            $from.append(opt);
            $to.append(opt);
        });
    }

    function renderOptionSelector(optionGroups) {
        const $wrap = $('#productOptionGroupWrap');
        $wrap.empty();

        optionGroups.forEach(group => {
            const groupHtml = `
        <div class="option_group">
            <div class="option_group_title">${group.optionGroupName}</div>
            <div class="option_items">
                ${group.options.map(opt => `
                    <label class="allergy_check_item">
                        <input type="checkbox"
                               name="option"
                               value="${opt.optionId}">
                        <span class="allergy_name">
                            ${opt.optionName} (+₩${opt.defaultPrice})
                        </span>
                        <div class="allergy_icon">
                            <i class="fas fa-check"></i>
                        </div>
                    </label>
                `).join('')}
            </div>
        </div>
        `;
            $wrap.append(groupHtml);
        });
    }


    async function loadSelectors() {
        const [opts, mats, alls] = await Promise.all([
            fetch(OPTION_API).then(r => r.json()),
            fetch(MATERIAL_API).then(r => r.json()),
            fetch(ALLERGY_API).then(r => r.json())
        ]);

        renderOptionSelector(opts);
        renderMaterialSelector(mats);
        renderAllergySelector(alls);
    }

    $(document).ready(function () {
        loadSelectors();
        loadProductList(1);
    });

    $(document).ready(function () {
        $('.product_search_btn').on('click', () => searchProducts(1));

        $('.product_search_input').on('keyup', function (e) {
            if (e.key === 'Enter') {
                searchProducts(1);
            }
        });
    });


    function renderPagination(totalPages, currentPage) {
        const $wrap = $('.board_page ul');
        $wrap.empty();

        if (totalPages <= 1) return;

        // 처음
        $wrap.append(`
        <li>
            <a href="javascript:void(0)" onclick="loadProductList(1)">
                <span>처음</span>
            </a>
        </li>
    `);

        // 페이지 번호
        for (let i = 1; i <= totalPages; i++) {
            $wrap.append(`
            <li class="${i === currentPage ? 'board_page_check' : ''}">
                <a href="javascript:void(0)" onclick="loadProductList(${i})">
                    <span>${i}</span>
                </a>
            </li>
        `);
        }

        // 마지막
        $wrap.append(`
        <li>
            <a href="javascript:void(0)" onclick="loadProductList(${totalPages})">
                <span>마지막</span>
            </a>
        </li>
    `);
    }

</script>
</body>
</html>