<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>메뉴 조회 테스트</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: #f5f5f5;
        }
        header {
            background-color: #333;
            color: #fff;
            padding: 16px 24px;
        }
        header h1 {
            margin: 0;
            font-size: 20px;
        }
        main {
            display: flex;
            height: calc(100vh - 60px);
        }
        #menu-list-panel {
            width: 35%;
            border-right: 1px solid #ddd;
            background-color: #fff;
            overflow-y: auto;
        }
        #menu-detail-panel {
            flex: 1;
            padding: 16px 24px;
            overflow-y: auto;
        }
        .menu-item {
            padding: 10px 14px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        .menu-item:hover {
            background-color: #f0f0f0;
        }
        .menu-item.active {
            background-color: #dfefff;
        }
        .menu-name {
            font-weight: bold;
        }
        .menu-meta {
            font-size: 12px;
            color: #666;
        }
        .section-title {
            font-size: 16px;
            font-weight: bold;
            margin-top: 16px;
            margin-bottom: 8px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 4px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 6px 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .tag {
            display: inline-block;
            font-size: 11px;
            padding: 2px 6px;
            margin-right: 4px;
            border-radius: 4px;
            background-color: #eee;
        }
        .small-text {
            font-size: 12px;
            color: #555;
        }
        .error {
            color: #d00;
            font-size: 13px;
            margin-top: 8px;
        }
    </style>
</head>
<body>
<header>
    <h1>카페 메뉴 조회 테스트 페이지</h1>
</header>
<main>
    <!-- 왼쪽: 메뉴 리스트 -->
    <section id="menu-list-panel">
        <div style="padding: 10px 14px; border-bottom: 1px solid #ddd;">
            <strong>메뉴 목록</strong>
            <div class="small-text">메뉴를 클릭하면 상세 정보가 오른쪽에 표시됩니다.</div>
        </div>
        <div id="menu-list"></div>
    </section>

    <!-- 오른쪽: 메뉴 상세 -->
    <section id="menu-detail-panel">
        <h2>메뉴 상세 정보</h2>
        <p class="small-text">왼쪽에서 메뉴를 선택하세요.</p>
        <div id="detail-content"></div>
        <div id="error-box" class="error"></div>
    </section>
</main>

<script>
    const API_BASE = '/api/menu'; // Spring Boot 컨트롤러 @RequestMapping("/api/menu")

    async function fetchMenus() {
        try {
            const res = await fetch(API_BASE);
            if (!res.ok) throw new Error('메뉴 목록 조회 실패: ' + res.status);
            return await res.json();
        } catch (e) {
            showError(e.message);
            return [];
        }
    }

    async function fetchMenuDetail(menuCode) {
        try {
            const res = await fetch(`${API_BASE}/${menuCode}`);
            if (!res.ok) throw new Error('메뉴 상세 조회 실패: ' + res.status);
            return await res.json();
        } catch (e) {
            showError(e.message);
            throw e;
        }
    }

    function showError(msg) {
        const box = document.getElementById('error-box');
        box.textContent = msg || '';
    }

    function clearError() {
        showError('');
    }

    function renderMenuList(menus) {
        const container = document.getElementById('menu-list');
        container.innerHTML = '';

        if (!menus || menus.length === 0) {
            container.innerHTML = '<p style="padding:10px;">등록된 메뉴가 없습니다.</p>';
            return;
        }

        menus.forEach(menu => {
            const div = document.createElement('div');
            div.className = 'menu-item';
            div.dataset.menuCode = menu.menuCode;

            div.innerHTML = `
                <div class="menu-name">${menu.menuName} (${menu.menuCode})</div>
                <div class="menu-meta">
                    카테고리: ${menu.category || '-'} /
                    가격: ${menu.basePrice != null ? menu.basePrice.toLocaleString() + '원' : '-'}
                </div>
            `;

            div.addEventListener('click', async () => {
                document.querySelectorAll('.menu-item').forEach(e => e.classList.remove('active'));
                div.classList.add('active');
                clearError();
                const detail = await fetchMenuDetail(menu.menuCode);
                renderMenuDetail(detail);
            });

            container.appendChild(div);
        });
    }

    function renderMenuDetail(detail) {
        const container = document.getElementById('detail-content');
        container.innerHTML = '';

        if (!detail) {
            container.innerHTML = '<p>상세 정보를 불러오지 못했습니다.</p>';
            return;
        }

        // 기본 정보
        const baseInfoHtml = `
            <div class="section-title">기본 정보</div>
            <p><strong>${detail.menuName} (${detail.menuCode})</strong></p>
            <p class="small-text">
                카테고리: <span class="tag">${detail.category || '-'}</span>
                기본 가격: ${detail.basePrice != null ? detail.basePrice.toLocaleString() + '원' : '-'}<br>
                기본 용량: ${detail.baseVolume || '-'}<br>
                알레르기 정보: ${detail.allergyInfo || '-'}<br>
                제작 시간: ${detail.createTime != null ? detail.createTime + '초' : '-'}
            </p>
            <p>${detail.description || ''}</p>
        `;

        container.insertAdjacentHTML('beforeend', baseInfoHtml);

        // 영양 정보
        if (detail.nutrition) {
            const n = detail.nutrition;
            const nutritionHtml = `
                <div class="section-title">영양 정보</div>
                <table>
                    <tr>
                        <th>칼로리(kcal)</th>
                        <th>나트륨(mg)</th>
                        <th>탄수화물(g)</th>
                        <th>당류(g)</th>
                        <th>단백질(g)</th>
                        <th>지방(g)</th>
                        <th>포화지방(g)</th>
                        <th>카페인(mg)</th>
                    </tr>
                    <tr>
                        <td>${n.calories ?? '-'}</td>
                        <td>${n.sodium ?? '-'}</td>
                        <td>${n.carbs ?? '-'}</td>
                        <td>${n.sugars ?? '-'}</td>
                        <td>${n.protein ?? '-'}</td>
                        <td>${n.fat ?? '-'}</td>
                        <td>${n.saturatedFat ?? '-'}</td>
                        <td>${n.caffeine ?? '-'}</td>
                    </tr>
                </table>
            `;
            container.insertAdjacentHTML('beforeend', nutritionHtml);
        }

        // 옵션 정보
        if (detail.optionList && detail.optionList.length > 0) {
            const rows = detail.optionList.map(o => `
                <tr>
                    <td>${o.optionGroupName || '-'}</td>
                    <td>${o.optionName || '-'}</td>
                    <td>${o.defaultPrice != null ? o.defaultPrice.toLocaleString() + '원' : '-'}</td>
                </tr>
            `).join('');

            const optionHtml = `
                <div class="section-title">옵션 정보</div>
                <table>
                    <tr>
                        <th>옵션 그룹</th>
                        <th>옵션명</th>
                        <th>추가 금액</th>
                    </tr>
                    ${rows}
                </table>
            `;
            container.insertAdjacentHTML('beforeend', optionHtml);
        } else {
            container.insertAdjacentHTML('beforeend',
                `<div class="section-title">옵션 정보</div>
                 <p class="small-text">등록된 옵션이 없습니다.</p>`);
        }

        // 레시피는 프론트에 안 보여주기로 했으니까 여기선 일부러 안 씀
    }

    // 초기 로딩
    (async function init() {
        clearError();
        const menus = await fetchMenus();
        renderMenuList(menus);
    })();
</script>
</body>
</html>
