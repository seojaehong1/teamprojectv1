<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Menu CRUD Test Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #fafafa;
            margin: 0;
        }
        header {
            padding: 16px;
            background: #333;
            color: white;
            font-size: 18px;
        }
        main {
            display: flex;
            height: calc(100vh - 60px);
        }
        #left-panel {
            width: 35%;
            background: white;
            border-right: 1px solid #ddd;
            overflow-y: auto;
            padding: 10px;
        }
        #right-panel {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        .menu-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        .menu-item:hover {
            background: #f2f2f2;
        }
        .active {
            background: #dce9ff !important;
        }
        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin: 20px 0 10px;
            border-bottom: 1px solid #aaa;
            padding-bottom: 5px;
        }
        input, textarea, select {
            width: 100%;
            padding: 6px;
            margin: 4px 0 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            padding: 8px 12px;
            border: none;
            background: #4caf50;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            opacity: 0.85;
        }
        .danger {
            background: #d9534f;
        }
        .warning {
            background: #ff9800;
        }
    </style>
</head>
<body>

<header>ğŸ“Œ ë©”ë‰´ CRUD í…ŒìŠ¤íŠ¸ í˜ì´ì§€</header>

<main>
    <!-- â–£ ì™¼ìª½: ë©”ë‰´ ë¦¬ìŠ¤íŠ¸ -->
    <section id="left-panel">
        <h3>ë©”ë‰´ ëª©ë¡</h3>
        <button onclick="loadMenus()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        <div id="menu-list"></div>
    </section>

    <!-- â–£ ì˜¤ë¥¸ìª½: ìƒì„¸ & CRUD -->
    <section id="right-panel">
        <h3>ë©”ë‰´ ìƒì„¸ ì •ë³´</h3>
        <div id="detail-box">ë©”ë‰´ë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>

        <div class="section-title">ë©”ë‰´ ë“±ë¡ (CREATE)</div>

        <form id="create-form">
            <input type="text" id="c-menuCode" placeholder="ë©”ë‰´ ì½”ë“œ" required>
            <input type="text" id="c-menuName" placeholder="ë©”ë‰´ëª…" required>
            <input type="text" id="c-category" placeholder="ì¹´í…Œê³ ë¦¬">
            <input type="number" id="c-basePrice" placeholder="ê¸°ë³¸ ê°€ê²©" required>
            <input type="text" id="c-baseVolume" placeholder="ê¸°ë³¸ ìš©ëŸ‰">
            <input type="text" id="c-allergyInfo" placeholder="ì•Œë ˆë¥´ê¸° ì •ë³´">
            <input type="number" id="c-createTime" placeholder="ì œì‘ ì‹œê°„">
            <textarea id="c-description" placeholder="ì„¤ëª…"></textarea>

            <button type="button" onclick="createMenu()">ë©”ë‰´ ë“±ë¡</button>
        </form>

        <div class="section-title">ë©”ë‰´ ìˆ˜ì • (UPDATE)</div>
        <form id="update-form">
            <input type="text" id="u-menuName" placeholder="ë©”ë‰´ëª…">
            <input type="text" id="u-category" placeholder="ì¹´í…Œê³ ë¦¬">
            <input type="number" id="u-basePrice" placeholder="ê¸°ë³¸ ê°€ê²©">
            <input type="text" id="u-baseVolume" placeholder="ê¸°ë³¸ ìš©ëŸ‰">
            <input type="text" id="u-allergyInfo" placeholder="ì•Œë ˆë¥´ê¸° ì •ë³´">
            <input type="number" id="u-createTime" placeholder="ì œì‘ ì‹œê°„">
            <textarea id="u-description" placeholder="ì„¤ëª…"></textarea>

            <button type="button" class="warning" onclick="updateMenu()">ë©”ë‰´ ìˆ˜ì •</button>
            <button type="button" class="danger" onclick="deleteMenu()">ë©”ë‰´ ì‚­ì œ</button>
        </form>
    </section>
</main>

<script>
    const API = "/api/menu";
    let selectedMenuCode = null;

    // â–£ ë©”ë‰´ ëª©ë¡ ì¡°íšŒ
    async function loadMenus() {
        const res = await fetch(API);
        const menus = await res.json();

        const list = document.getElementById("menu-list");
        list.innerHTML = "";

        menus.forEach(m => {
            const div = document.createElement("div");
            div.className = "menu-item";
            div.innerHTML = `${m.menuName} (${m.menuCode})`;
            div.onclick = () => selectMenu(m.menuCode, div);
            list.appendChild(div);
        });
    }

    // â–£ ë©”ë‰´ ì„ íƒ â†’ ìƒì„¸ ì¡°íšŒ
    async function selectMenu(menuCode, element) {
        selectedMenuCode = menuCode;

        document.querySelectorAll(".menu-item").forEach(e => e.classList.remove("active"));
        element.classList.add("active");

        const res = await fetch(`${API}/${menuCode}`);
        const data = await res.json();

        document.getElementById("detail-box").innerHTML = `
            <strong>${data.menuName}</strong> (${data.menuCode})<br>
            ì¹´í…Œê³ ë¦¬: ${data.category || "-"}<br>
            ê°€ê²©: ${data.basePrice}ì›<br>
            ìš©ëŸ‰: ${data.baseVolume || "-"}<br>
            ì•Œë ˆë¥´ê¸°: ${data.allergyInfo || "-"}<br>
            ì œì‘ ì‹œê°„: ${data.createTime || "-"} ì´ˆ<br>
            ì„¤ëª…: ${data.description || "-"}
        `;

        // UPDATE í¼ ìë™ ë¡œë“œ
        document.getElementById("u-menuName").value = data.menuName || "";
        document.getElementById("u-category").value = data.category || "";
        document.getElementById("u-basePrice").value = data.basePrice || "";
        document.getElementById("u-baseVolume").value = data.baseVolume || "";
        document.getElementById("u-allergyInfo").value = data.allergyInfo || "";
        document.getElementById("u-createTime").value = data.createTime || "";
        document.getElementById("u-description").value = data.description || "";
    }

    // â–£ CREATE
    async function createMenu() {
        const payload = {
            menuCode: document.getElementById("c-menuCode").value,
            menuName: document.getElementById("c-menuName").value,
            category: document.getElementById("c-category").value,
            basePrice: Number(document.getElementById("c-basePrice").value),
            baseVolume: document.getElementById("c-baseVolume").value,
            allergyInfo: document.getElementById("c-allergyInfo").value,
            createTime: Number(document.getElementById("c-createTime").value),
            description: document.getElementById("c-description").value
        };

        await fetch(API, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(payload)
        });

        alert("ë“±ë¡ ì™„ë£Œ!");
        loadMenus();
    }

    // â–£ UPDATE
    async function updateMenu() {
        if (!selectedMenuCode) return alert("ë©”ë‰´ë¥¼ ì„ íƒí•˜ì„¸ìš”!");

        const payload = {
            menuName: document.getElementById("u-menuName").value,
            category: document.getElementById("u-category").value,
            basePrice: Number(document.getElementById("u-basePrice").value),
            baseVolume: document.getElementById("u-baseVolume").value,
            allergyInfo: document.getElementById("u-allergyInfo").value,
            createTime: Number(document.getElementById("u-createTime").value),
            description: document.getElementById("u-description").value
        };

        await fetch(`${API}/${selectedMenuCode}`, {
            method: "PUT",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(payload)
        });

        alert("ìˆ˜ì • ì™„ë£Œ!");
        loadMenus();
    }

    // â–£ DELETE
    async function deleteMenu() {
        if (!selectedMenuCode) return alert("ë©”ë‰´ë¥¼ ì„ íƒí•˜ì„¸ìš”!");

        if (!confirm("ì •ë§ ì‚­ì œí• ê¹Œìš”?")) return;

        await fetch(`${API}/${selectedMenuCode}`, { method: "DELETE" });

        alert("ì‚­ì œ ì™„ë£Œ!");
        loadMenus();
        document.getElementById("detail-box").innerHTML = "ë©”ë‰´ë¥¼ ì„ íƒí•˜ì„¸ìš”.";
    }

    loadMenus();
</script>

</body>
</html>
