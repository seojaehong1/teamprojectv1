# ì„œë²„ ì¸í”„ë¼ í•™ìŠµ ê°€ì´ë“œ (ì£¼ë‹ˆì–´ ê°œë°œììš©)

> TORI COFFEE í”„ë¡œì íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ Kubernetes & AWS ì¸í”„ë¼ í•™ìŠµ ë¬¸ì„œ
> ì´ ë¬¸ì„œëŠ” ì‹¤ì œ í”„ë¡œì íŠ¸ ì„¤ì •ì„ ì˜ˆì‹œë¡œ ë“¤ì–´ ì„¤ëª…í•©ë‹ˆë‹¤.

---

## ëª©ì°¨

1. [ê¸°ë³¸ ê°œë… ì´í•´í•˜ê¸°](#1-ê¸°ë³¸-ê°œë…-ì´í•´í•˜ê¸°)
2. [ì™œ DBë¥¼ 4ê°œë¡œ ë¶„ë¦¬í–ˆì„ê¹Œ?](#2-ì™œ-dbë¥¼-4ê°œë¡œ-ë¶„ë¦¬í–ˆì„ê¹Œ)
3. [Kubernetes í•µì‹¬ ê°œë…](#3-kubernetes-í•µì‹¬-ê°œë…)
4. [AWS EKS êµ¬ì„±ìš”ì†Œ](#4-aws-eks-êµ¬ì„±ìš”ì†Œ)
5. [HPA (ìë™ ìŠ¤ì¼€ì¼ë§)](#5-hpa-ìë™-ìŠ¤ì¼€ì¼ë§)
6. [Ingressì™€ ë¡œë“œë°¸ëŸ°ì‹±](#6-ingressì™€-ë¡œë“œë°¸ëŸ°ì‹±)
7. [ì„œë¹„ìŠ¤ ê°„ í†µì‹ ](#7-ì„œë¹„ìŠ¤-ê°„-í†µì‹ )
8. [ë¦¬ì†ŒìŠ¤ ê´€ë¦¬](#8-ë¦¬ì†ŒìŠ¤-ê´€ë¦¬)
9. [ë°ì´í„° ì˜ì†ì„± (PV/PVC)](#9-ë°ì´í„°-ì˜ì†ì„±-pvpvc)
10. [ConfigMapê³¼ Secret](#10-configmapê³¼-secret)
11. [í—¬ìŠ¤ ì²´í¬ (Probe)](#11-í—¬ìŠ¤-ì²´í¬-probe)
12. [ì‹¤ì œ íŠ¸ë˜í”½ íë¦„](#12-ì‹¤ì œ-íŠ¸ë˜í”½-íë¦„)

---

## 1. ê¸°ë³¸ ê°œë… ì´í•´í•˜ê¸°

### 1.1 ì „í†µì ì¸ ì„œë²„ vs ì»¨í…Œì´ë„ˆ

```
[ì „í†µì ì¸ ë°©ì‹]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ë¬¼ë¦¬ ì„œë²„            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    ìš´ì˜ì²´ì œ (Linux)     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚App1 â”‚ â”‚App2 â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ë¬¸ì œì :
- App1ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ A v1.0 í•„ìš”
- App2ê°€ ë¼ì´ë¸ŒëŸ¬ë¦¬ A v2.0 í•„ìš”
- ì¶©ëŒ ë°œìƒ! ğŸ˜±
```

```
[ì»¨í…Œì´ë„ˆ ë°©ì‹]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ë¬¼ë¦¬ ì„œë²„            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    ìš´ì˜ì²´ì œ (Linux)     â”‚  â”‚
â”‚  â”‚    Docker Engine       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚ì»¨í…Œì´ë„ˆâ”‚ â”‚ì»¨í…Œì´ë„ˆâ”‚     â”‚  â”‚
â”‚  â”‚  â”‚App1 â”‚ â”‚App2 â”‚     â”‚  â”‚
â”‚  â”‚  â”‚v1.0 â”‚ â”‚v2.0 â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

í•´ê²°:
- ê° ì»¨í…Œì´ë„ˆê°€ ë…ë¦½ì ì¸ í™˜ê²½
- ì„œë¡œ ì˜í–¥ ì—†ìŒ! ğŸ˜Š
```

### 1.2 ì£¼ìš” ìš©ì–´ ì •ë¦¬

| ìš©ì–´ | ì‰¬ìš´ ì„¤ëª… | ë¹„ìœ  |
|------|----------|------|
| **ì»¨í…Œì´ë„ˆ** | ì•± + ì‹¤í–‰í™˜ê²½ì„ íŒ¨í‚¤ì§•í•œ ê²ƒ | ì´ì‚¬í•  ë•Œ ì“°ëŠ” ë°•ìŠ¤ ğŸ“¦ |
| **ì´ë¯¸ì§€** | ì»¨í…Œì´ë„ˆë¥¼ ë§Œë“¤ê¸° ìœ„í•œ ì„¤ê³„ë„ | ë¶•ì–´ë¹µ í‹€ ğŸŸ |
| **Docker** | ì»¨í…Œì´ë„ˆë¥¼ ë§Œë“¤ê³  ì‹¤í–‰í•˜ëŠ” ë„êµ¬ | ë¶•ì–´ë¹µ êµ½ëŠ” ê¸°ê³„ |
| **Kubernetes (K8s)** | ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆë¥¼ ê´€ë¦¬í•˜ëŠ” ë„êµ¬ | ë¶•ì–´ë¹µ ê°€ê²Œ ì‚¬ì¥ë‹˜ ğŸ‘¨â€ğŸ’¼ |
| **í´ëŸ¬ìŠ¤í„°** | K8sê°€ ê´€ë¦¬í•˜ëŠ” ì„œë²„ë“¤ì˜ ì§‘í•© | ë¶•ì–´ë¹µ ê°€ê²Œ ì²´ì¸ì  ì „ì²´ |
| **ë…¸ë“œ** | í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•˜ëŠ” ê°œë³„ ì„œë²„ | ê° ì²´ì¸ì  ë§¤ì¥ ğŸª |
| **íŒŒë“œ (Pod)** | K8sì—ì„œ ë°°í¬í•˜ëŠ” ìµœì†Œ ë‹¨ìœ„ (ì»¨í…Œì´ë„ˆ 1ê°œ ì´ìƒ) | ë¶•ì–´ë¹µ í•œ íŒ |

### 1.3 ìš°ë¦¬ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
[TORI COFFEE ì „ì²´ êµ¬ì¡°]

ì‚¬ìš©ì (ë¸Œë¼ìš°ì €)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AWS Cloud                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              EKS Cluster (teamproject-cluster)     â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚  â”‚
â”‚  â”‚   â”‚ Node 1  â”‚  â”‚ Node 2  â”‚  â”‚ Node 3  â”‚  ...     â”‚  â”‚
â”‚  â”‚   â”‚(EC2)    â”‚  â”‚(EC2)    â”‚  â”‚(EC2)    â”‚          â”‚  â”‚
â”‚  â”‚   â”‚         â”‚  â”‚         â”‚  â”‚         â”‚          â”‚  â”‚
â”‚  â”‚   â”‚ [Pods]  â”‚  â”‚ [Pods]  â”‚  â”‚ [Pods]  â”‚          â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚  â”‚   ECR   â”‚  â”‚   ALB   â”‚                              â”‚
â”‚  â”‚(ì´ë¯¸ì§€) â”‚  â”‚(ë¡œë“œë°¸ëŸ°ì„œ)â”‚                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ì™œ DBë¥¼ 4ê°œë¡œ ë¶„ë¦¬í–ˆì„ê¹Œ?

### 2.1 MSA (Microservices Architecture)ì˜ í•µì‹¬ ì›ì¹™

```
[ëª¨ë†€ë¦¬ì‹ (ì „í†µì ì¸ ë°©ì‹)]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          í•˜ë‚˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ íšŒì›  â”‚ â”‚ ìƒí’ˆ  â”‚ â”‚ ì£¼ë¬¸  â”‚  â”‚
â”‚  â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚              â–¼               â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚      â”‚   í•˜ë‚˜ì˜ DB   â”‚         â”‚
â”‚      â”‚  (ëª¨ë“  í…Œì´ë¸”) â”‚         â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ë¬¸ì œì :
âŒ íšŒì› ê¸°ëŠ¥ ìˆ˜ì •í•˜ë©´ ì „ì²´ ì¬ë°°í¬
âŒ ì£¼ë¬¸ì´ í­ì£¼í•˜ë©´ ì „ì²´ ì„œë²„ ì¦ì„¤ í•„ìš”
âŒ DB ì¥ì•  = ì „ì²´ ì„œë¹„ìŠ¤ ì¥ì• 
âŒ íŒ€ ê°„ ì½”ë“œ ì¶©ëŒ ë¹ˆë²ˆ
```

```
[MSA (ìš°ë¦¬ í”„ë¡œì íŠ¸)]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ member  â”‚ â”‚ product â”‚ â”‚  order  â”‚ â”‚inventoryâ”‚
â”‚ service â”‚ â”‚ service â”‚ â”‚ service â”‚ â”‚ service â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚           â”‚           â”‚           â”‚
     â–¼           â–¼           â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚member_dbâ”‚ â”‚product_ â”‚ â”‚order_db â”‚ â”‚inventoryâ”‚
â”‚         â”‚ â”‚   db    â”‚ â”‚         â”‚ â”‚   _db   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì¥ì :
âœ… íšŒì› ê¸°ëŠ¥ë§Œ ìˆ˜ì • â†’ íšŒì› ì„œë¹„ìŠ¤ë§Œ ì¬ë°°í¬
âœ… ì£¼ë¬¸ í­ì£¼ â†’ ì£¼ë¬¸ ì„œë¹„ìŠ¤ë§Œ ì¦ì„¤ (HPA!)
âœ… member_db ì¥ì•  â†’ íšŒì›ë§Œ ì•ˆë¨, ë‚˜ë¨¸ì§€ ì •ìƒ
âœ… íŒ€ë³„ ë…ë¦½ ê°œë°œ ê°€ëŠ¥
```

### 2.2 ìš°ë¦¬ í”„ë¡œì íŠ¸ì˜ DB êµ¬ì„±

| DB ì´ë¦„ | ë‹´ë‹¹ ì„œë¹„ìŠ¤ | ì €ì¥ ë°ì´í„° | ë¶„ë¦¬ ì´ìœ  |
|---------|------------|------------|----------|
| `member_db` | member-service | íšŒì›, ì¸ì¦, í† í° | ì¸ì¦ì€ ë³´ì•ˆì´ ì¤‘ìš”, ë…ë¦½ ê´€ë¦¬ |
| `product_db` | product-service | ë©”ë‰´, ì¹´í…Œê³ ë¦¬, ì˜µì…˜ | ì½ê¸°ê°€ ë§ìŒ, ìºì‹± ìµœì í™” ê°€ëŠ¥ |
| `order_db` | order-service | ì£¼ë¬¸, ì¥ë°”êµ¬ë‹ˆ | ì“°ê¸°ê°€ ë§ìŒ, íŠ¸ëœì­ì…˜ ì§‘ì¤‘ |
| `inventory_db` | inventory-service | ì¬ê³ , ì›ì¬ë£Œ, ë ˆì‹œí”¼ | ì‹¤ì‹œê°„ ì¬ê³  ê´€ë¦¬, ë™ì‹œì„± ì œì–´ |

### 2.3 ì‹¤ì œ K8s ì„¤ì • (mysql-product.yaml ì˜ˆì‹œ)

```yaml
# k8s/mysql/mysql-product.yaml

apiVersion: apps/v1
kind: StatefulSet          # âš ï¸ Deploymentê°€ ì•„ë‹Œ StatefulSet ì‚¬ìš©
metadata:
  name: mysql-product
  namespace: tori-app
spec:
  serviceName: mysql-product   # ê³ ì •ëœ ë„¤íŠ¸ì›Œí¬ ì´ë¦„
  replicas: 1
  selector:
    matchLabels:
      app: mysql-product
  template:
    spec:
      containers:
        - name: mysql
          image: mysql:8.0
          env:
            - name: MYSQL_DATABASE
              value: "product_db"      # ì´ DBë§Œ ìƒì„±
            - name: MYSQL_ROOT_PASSWORD
              valueFrom:
                secretKeyRef:          # ë¹„ë°€ë²ˆí˜¸ëŠ” Secretì—ì„œ
                  name: db-secrets
                  key: MYSQL_PRODUCT_ROOT_PASSWORD
          volumeMounts:
            - name: mysql-storage
              mountPath: /var/lib/mysql  # ë°ì´í„° ì €ì¥ ìœ„ì¹˜
  volumeClaimTemplates:
    - metadata:
        name: mysql-storage
      spec:
        accessModes: ["ReadWriteOnce"]
        resources:
          requests:
            storage: 10Gi              # 10GB ë³¼ë¥¨ ìš”ì²­
```

**ì™œ StatefulSetì¸ê°€?**

| Deployment | StatefulSet |
|------------|-------------|
| íŒŒë“œ ì´ë¦„ì´ ëœë¤ (pod-abc123) | íŒŒë“œ ì´ë¦„ì´ ê³ ì • (mysql-product-0) |
| ìˆœì„œ ì—†ì´ ìƒì„±/ì‚­ì œ | ìˆœì„œëŒ€ë¡œ ìƒì„±, ì—­ìˆœìœ¼ë¡œ ì‚­ì œ |
| ì €ì¥ì†Œ ê³µìœ  ê°€ëŠ¥ | ê° íŒŒë“œê°€ ê³ ìœ í•œ ì €ì¥ì†Œ |
| ì›¹ ì„œë²„ì— ì í•© | **ë°ì´í„°ë² ì´ìŠ¤ì— ì í•©** âœ… |

---

## 3. Kubernetes í•µì‹¬ ê°œë…

### 3.1 Pod (íŒŒë“œ)

```
K8sì—ì„œ ë°°í¬í•˜ëŠ” ê°€ì¥ ì‘ì€ ë‹¨ìœ„

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Pod               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ Container â”‚  â† ë³´í†µ 1ê°œ  â”‚
â”‚  â”‚ (Spring)  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                             â”‚
â”‚  IP: 10.0.0.15             â”‚
â”‚  Port: 8005                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

íŠ¹ì§•:
- íŒŒë“œ ë‚´ ì»¨í…Œì´ë„ˆë“¤ì€ ê°™ì€ IP ê³µìœ 
- íŒŒë“œëŠ” ì–¸ì œë“  ì£½ì„ ìˆ˜ ìˆìŒ (ë¹„ì˜êµ¬ì )
- ì£½ìœ¼ë©´ ìƒˆ íŒŒë“œê°€ ìƒˆ IPë¡œ ìƒì„±ë¨
```

### 3.2 Deployment (ë””í”Œë¡œì´ë¨¼íŠ¸)

```yaml
# k8s/services/frontend-service.yaml

apiVersion: apps/v1
kind: Deployment
metadata:
  name: frontend-service
  namespace: tori-app
spec:
  replicas: 1                    # íŒŒë“œ ê°œìˆ˜ (HPAê°€ ì¡°ì ˆí•¨)
  selector:
    matchLabels:
      app: frontend-service      # ì´ ë¼ë²¨ì„ ê°€ì§„ íŒŒë“œë¥¼ ê´€ë¦¬
  template:                      # íŒŒë“œ í…œí”Œë¦¿
    metadata:
      labels:
        app: frontend-service    # íŒŒë“œì— ë¶™ëŠ” ë¼ë²¨
    spec:
      containers:
        - name: frontend-service
          image: 490866675691.dkr.ecr.../frontend-service:latest
          ports:
            - containerPort: 8005
```

**Deploymentê°€ í•˜ëŠ” ì¼:**

```
[Deployment: frontend-service]
        â”‚
        â”‚ "replicas: 3 ìœ ì§€í•´!"
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pod 1  â”‚ â”‚  Pod 2  â”‚ â”‚  Pod 3  â”‚
â”‚(ì •ìƒ âœ…)â”‚ â”‚(ì£½ìŒ âŒ)â”‚ â”‚(ì •ìƒ âœ…)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
        "ì–´? Pod 2 ì£½ì—ˆë„¤?"
        "ìƒˆ Pod 2 ë§Œë“¤ì–´ì•¼ì§€!"
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pod 1  â”‚ â”‚ Pod 2'  â”‚ â”‚  Pod 3  â”‚
â”‚(ì •ìƒ âœ…)â”‚ â”‚(ìƒˆë¡œìƒì„±)â”‚ â”‚(ì •ìƒ âœ…)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 Service (ì„œë¹„ìŠ¤)

```
íŒŒë“œëŠ” IPê°€ ê³„ì† ë°”ë€ŒëŠ”ë°, ì–´ë–»ê²Œ ì°¾ì§€? â†’ Serviceê°€ í•´ê²°!

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Service: frontend-service       â”‚
â”‚     ClusterIP: 10.100.50.25        â”‚
â”‚     Port: 8005                      â”‚
â”‚                 â”‚                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â–¼            â–¼            â–¼     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚Pod 1 â”‚   â”‚Pod 2 â”‚   â”‚Pod 3 â”‚    â”‚
â”‚ â”‚.0.10 â”‚   â”‚.0.11 â”‚   â”‚.0.12 â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì—ì„œ í˜¸ì¶œí•  ë•Œ:
http://frontend-service:8005  â† ì´ë¦„ìœ¼ë¡œ í˜¸ì¶œ ê°€ëŠ¥!
(K8s DNSê°€ ìë™ìœ¼ë¡œ IP ì°¾ì•„ì¤Œ)
```

```yaml
# Service ì •ì˜

apiVersion: v1
kind: Service
metadata:
  name: frontend-service
  namespace: tori-app
spec:
  selector:
    app: frontend-service    # ì´ ë¼ë²¨ì„ ê°€ì§„ íŒŒë“œë“¤ì—ê²Œ íŠ¸ë˜í”½ ì „ë‹¬
  ports:
    - port: 8005             # Service í¬íŠ¸
      targetPort: 8005       # íŒŒë“œì˜ í¬íŠ¸
```

### 3.4 Namespace (ë„¤ì„ìŠ¤í˜ì´ìŠ¤)

```
í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ ë¦¬ì†ŒìŠ¤ë¥¼ ë…¼ë¦¬ì ìœ¼ë¡œ ë¶„ë¦¬

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Kubernetes Cluster              â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Namespace:       â”‚  â”‚ Namespace:       â”‚  â”‚
â”‚  â”‚ tori-app        â”‚  â”‚ kube-system      â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚
â”‚  â”‚ - frontend      â”‚  â”‚ - coredns       â”‚  â”‚
â”‚  â”‚ - member        â”‚  â”‚ - aws-lb-ctrl   â”‚  â”‚
â”‚  â”‚ - product       â”‚  â”‚ - ebs-csi       â”‚  â”‚
â”‚  â”‚ - mysqlë“¤       â”‚  â”‚                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                             â”‚
â”‚  ìš°ë¦¬ ì•±               K8s ì‹œìŠ¤í…œ ì»´í¬ë„ŒíŠ¸    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. AWS EKS êµ¬ì„±ìš”ì†Œ

### 4.1 EKS (Elastic Kubernetes Service)

```
AWSê°€ ê´€ë¦¬í•´ì£¼ëŠ” Kubernetes

[ì§ì ‘ K8s ì„¤ì¹˜]                    [EKS ì‚¬ìš©]

Master Node ì§ì ‘ ê´€ë¦¬ ğŸ˜°           AWSê°€ ê´€ë¦¬ ğŸ˜Š
- etcd ë°±ì—…                       - ìë™ ë°±ì—…
- API Server ê´€ë¦¬                 - ìë™ ì—…ë°ì´íŠ¸
- ì¥ì•  ì‹œ ì§ì ‘ ë³µêµ¬                - ìë™ ë³µêµ¬

â†’ ìš°ë¦¬ëŠ” Worker Nodeë§Œ ì‹ ê²½ì“°ë©´ ë¨!
```

### 4.2 EC2 (Worker Node)

```yaml
# k8s/cluster-config.yaml

managedNodeGroups:
  - name: tori-nodes
    instanceType: t3.medium      # ì¸ìŠ¤í„´ìŠ¤ íƒ€ì…
    desiredCapacity: 5           # ì›í•˜ëŠ” ë…¸ë“œ ìˆ˜
    minSize: 3                   # ìµœì†Œ ë…¸ë“œ ìˆ˜
    maxSize: 7                   # ìµœëŒ€ ë…¸ë“œ ìˆ˜
```

**t3.medium ìŠ¤í™:**
| í•­ëª© | ê°’ |
|------|-----|
| vCPU | 2ê°œ |
| ë©”ëª¨ë¦¬ | 4GB |
| ë„¤íŠ¸ì›Œí¬ | ì¤‘ê°„ |
| ì‹œê°„ë‹¹ ë¹„ìš© | ~$0.05 (ì„œìš¸) |

**ì™œ 5ê°œ ë…¸ë“œì¸ê°€?**
```
ìš°ë¦¬ íŒŒë“œ êµ¬ì„±:
- ì• í”Œë¦¬ì¼€ì´ì…˜: 9ê°œ ì„œë¹„ìŠ¤
- MySQL: 4ê°œ
- RabbitMQ: 1ê°œ
- ì‹œìŠ¤í…œ íŒŒë“œ: ~10ê°œ (CoreDNS, CNI ë“±)

ì´ ì•½ 24ê°œ íŒŒë“œë¥¼ 5ê°œ ë…¸ë“œì— ë¶„ì‚°
â†’ ë…¸ë“œë‹¹ í‰ê·  4~5ê°œ íŒŒë“œ
â†’ í•œ ë…¸ë“œ ì£½ì–´ë„ ë‹¤ë¥¸ ë…¸ë“œê°€ ì»¤ë²„ ê°€ëŠ¥
```

### 4.3 ECR (Elastic Container Registry)

```
Docker Hubì˜ AWS ë²„ì „ (í”„ë¼ì´ë¹— ì´ë¯¸ì§€ ì €ì¥ì†Œ)

[ê°œë°œ PC]                         [ECR]                          [EKS]
   â”‚                                â”‚                               â”‚
   â”‚  docker build                  â”‚                               â”‚
   â”‚  docker tag                    â”‚                               â”‚
   â”‚  docker push â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                               â”‚
   â”‚                                â”‚                               â”‚
   â”‚                                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€ docker pull â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                                â”‚                               â”‚

ì €ì¥ì†Œ URL í˜•ì‹:
{AWSê³„ì •ID}.dkr.ecr.{ë¦¬ì „}.amazonaws.com/{ì•±ì´ë¦„}:{íƒœê·¸}

ìš°ë¦¬ í”„ë¡œì íŠ¸:
490866675691.dkr.ecr.ap-northeast-2.amazonaws.com/tori-app/frontend-service:latest
```

### 4.4 ALB (Application Load Balancer)

```
ì¸í„°ë„·ì—ì„œ ë“¤ì–´ì˜¤ëŠ” íŠ¸ë˜í”½ì„ ë¶„ì‚°

                    ì¸í„°ë„·
                       â”‚
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚     ALB     â”‚  â† AWSê°€ ê´€ë¦¬
              â”‚ (xxx.elb.   â”‚     ê³ ê°€ìš©ì„± ë³´ì¥
              â”‚  amazonaws) â”‚     ìë™ SSL ê°€ëŠ¥
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼          â–¼          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Pod 1  â”‚ â”‚ Pod 2  â”‚ â”‚ Pod 3  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

íŠ¹ì§•:
- L7 (HTTP/HTTPS) ë¡œë“œë°¸ëŸ°ì„œ
- URL ê²½ë¡œ ê¸°ë°˜ ë¼ìš°íŒ… ê°€ëŠ¥ (/api â†’ backend)
- í—¬ìŠ¤ ì²´í¬ë¡œ ì£½ì€ íŒŒë“œ ìë™ ì œì™¸
```

### 4.5 EBS (Elastic Block Store)

```
MySQL ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ì˜êµ¬ ë””ìŠ¤í¬

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Pod       â”‚          â”‚    EBS      â”‚
â”‚  (MySQL)    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Volume    â”‚
â”‚             â”‚  ë§ˆìš´íŠ¸   â”‚   (10GB)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

íŒŒë“œê°€ ì£½ì–´ë„ ë°ì´í„°ëŠ” EBSì— ì•ˆì „í•˜ê²Œ ë³´ê´€!
ìƒˆ íŒŒë“œê°€ ë– ë„ ê°™ì€ EBS ì—°ê²° â†’ ë°ì´í„° ìœ ì§€
```

---

## 5. HPA (ìë™ ìŠ¤ì¼€ì¼ë§)

### 5.1 HPAë€?

```
HPA = Horizontal Pod Autoscaler
      (ìˆ˜í‰ì  íŒŒë“œ ìë™ í™•ì¥ê¸°)

íŠ¸ë˜í”½ ì ì„ ë•Œ:          íŠ¸ë˜í”½ ë§ì„ ë•Œ:
â”Œâ”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
â”‚Pod 1â”‚                 â”‚Pod 1â”‚ â”‚Pod 2â”‚ â”‚Pod 3â”‚ â”‚Pod 4â”‚
â””â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜
CPU: 30%                CPU: 70% ì´ìƒì´ë©´ ìë™ í™•ì¥!

â†” ìˆ˜í‰ í™•ì¥: íŒŒë“œ ê°œìˆ˜ë¥¼ ëŠ˜ë¦¼
â†• ìˆ˜ì§ í™•ì¥: íŒŒë“œ ìŠ¤í™ì„ ì˜¬ë¦¼ (CPU, ë©”ëª¨ë¦¬)
```

### 5.2 ìš°ë¦¬ í”„ë¡œì íŠ¸ HPA ì„¤ì •

```yaml
# k8s/hpa/hpa.yaml

apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: frontend-service-hpa
  namespace: tori-app
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: frontend-service      # ì´ Deploymentë¥¼ ìŠ¤ì¼€ì¼ë§

  minReplicas: 2                # ìµœì†Œ 2ê°œ ìœ ì§€
  maxReplicas: 10               # ìµœëŒ€ 10ê°œê¹Œì§€

  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70    # CPU 70% ë„˜ìœ¼ë©´ í™•ì¥
    - type: Resource
      resource:
        name: memory
        target:
          type: Utilization
          averageUtilization: 80    # ë©”ëª¨ë¦¬ 80% ë„˜ìœ¼ë©´ í™•ì¥

  behavior:
    scaleUp:
      stabilizationWindowSeconds: 0   # ì¦‰ì‹œ í™•ì¥
      policies:
        - type: Percent
          value: 100                  # 100%ì”© ëŠ˜ë¦¼ (2â†’4â†’8)
          periodSeconds: 15
    scaleDown:
      stabilizationWindowSeconds: 300  # 5ë¶„ ëŒ€ê¸° í›„ ì¶•ì†Œ
      policies:
        - type: Percent
          value: 10                    # 10%ì”© ì¤„ì„
          periodSeconds: 60
```

### 5.3 HPA ë™ì‘ ì‹œë‚˜ë¦¬ì˜¤

```
[ì‹œë‚˜ë¦¬ì˜¤: ì ì‹¬ì‹œê°„ ì£¼ë¬¸ í­ì£¼]

12:00 - í‰ìƒì‹œ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ order-1 â”‚ â”‚ order-2 â”‚  CPU: 40%
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

12:15 - ì£¼ë¬¸ ì¦ê°€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ order-1 â”‚ â”‚ order-2 â”‚  CPU: 75% âš ï¸ 70% ì´ˆê³¼!
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼ HPA: "í™•ì¥í•´ì•¼ê² ë‹¤!"

12:16 - ìë™ í™•ì¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ order-1 â”‚ â”‚ order-2 â”‚ â”‚ order-3 â”‚ â”‚ order-4 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    CPU: 50%ë¡œ ë¶„ì‚°

13:30 - ì ì‹¬ ë, íŠ¸ë˜í”½ ê°ì†Œ
CPU: 25%... 5ë¶„ê°„ ìœ ì§€

13:35 - HPA: "ì¶•ì†Œí•´ë„ ë˜ê² ë‹¤"
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ order-1 â”‚ â”‚ order-2 â”‚ â”‚ order-3 â”‚  10%ì”© ì²œì²œíˆ ì¶•ì†Œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.4 ì„œë¹„ìŠ¤ë³„ HPA ì„¤ì • ì´ìœ 

| ì„œë¹„ìŠ¤ | min | max | ì´ìœ  |
|--------|-----|-----|------|
| frontend | 2 | 10 | ì‚¬ìš©ì ì§ì ‘ ì ‘ì†, íŠ¸ë˜í”½ ë³€ë™ í¼ |
| gateway | 2 | 10 | ëª¨ë“  API í†µê³¼, ë³‘ëª© ê°€ëŠ¥ |
| order | 2 | 10 | ì£¼ë¬¸ í”¼í¬ ì‹œ ê¸‰ì¦ |
| member | 2 | 8 | ë¡œê·¸ì¸ì€ ìƒëŒ€ì ìœ¼ë¡œ ì ìŒ |
| product | 2 | 8 | ì½ê¸° ìœ„ì£¼, ìºì‹± ê°€ëŠ¥ |
| inventory | 2 | 8 | ì£¼ë¬¸ë‹¹ 1ë²ˆ í˜¸ì¶œ |
| board | 2 | 6 | ê³µì§€ì‚¬í•­ì€ íŠ¸ë˜í”½ ì ìŒ |
| admin | 2 | 6 | ê´€ë¦¬ìë§Œ ì‚¬ìš© |

---

## 6. Ingressì™€ ë¡œë“œë°¸ëŸ°ì‹±

### 6.1 Ingressë€?

```
í´ëŸ¬ìŠ¤í„° ì™¸ë¶€ â†’ ë‚´ë¶€ë¡œ ë“¤ì–´ì˜¤ëŠ” HTTP íŠ¸ë˜í”½ì„ ê´€ë¦¬

[Ingress ì—†ì´]                    [Ingress ìˆìœ¼ë©´]

  ì‚¬ìš©ì                            ì‚¬ìš©ì
    â”‚                                â”‚
    â–¼                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LB 1   â”‚â”€â†’ frontend           â”‚ Ingress â”‚â”€â†’ / â†’ frontend
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚  (ALB)  â”‚â”€â†’ /api â†’ gateway
â”‚ LB 2   â”‚â”€â†’ gateway            â”‚         â”‚â”€â†’ /eureka â†’ eureka
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ LB 3   â”‚â”€â†’ eureka                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      ë¡œë“œë°¸ëŸ°ì„œ 1ê°œë¡œ í•´ê²°!
                                ë¹„ìš© ì ˆì•½ ğŸ’°
```

### 6.2 ìš°ë¦¬ í”„ë¡œì íŠ¸ Ingress ì„¤ì •

```yaml
# k8s/ingress.yaml

apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: tori-app-ingress
  namespace: tori-app
  annotations:
    # AWS ALBë¥¼ ì‚¬ìš©í•˜ê² ë‹¤
    kubernetes.io/ingress.class: alb

    # ì¸í„°ë„·ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ
    alb.ingress.kubernetes.io/scheme: internet-facing

    # íŒŒë“œ IPë¡œ ì§ì ‘ ì—°ê²° (ë¹ ë¦„)
    alb.ingress.kubernetes.io/target-type: ip

    # í—¬ìŠ¤ ì²´í¬ ì„¤ì •
    alb.ingress.kubernetes.io/healthcheck-path: /actuator/health
    alb.ingress.kubernetes.io/healthcheck-interval-seconds: '15'

spec:
  ingressClassName: alb
  rules:
    - http:
        paths:
          # / ë¡œ ì‹œì‘í•˜ëŠ” ìš”ì²­ â†’ frontend
          - path: /
            pathType: Prefix
            backend:
              service:
                name: frontend-service
                port:
                  number: 8005

          # /api ë¡œ ì‹œì‘í•˜ëŠ” ìš”ì²­ â†’ gateway
          - path: /api
            pathType: Prefix
            backend:
              service:
                name: gateway-service
                port:
                  number: 8000

          # /eureka ë¡œ ì‹œì‘í•˜ëŠ” ìš”ì²­ â†’ eureka
          - path: /eureka
            pathType: Prefix
            backend:
              service:
                name: eureka-server
                port:
                  number: 8761
```

### 6.3 ì‹¤ì œ URL ë¼ìš°íŒ…

```
http://k8s-toriapp-xxxxx.elb.amazonaws.com

ìš”ì²­ URL                          â†’  ë¼ìš°íŒ… ëŒ€ìƒ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/                                 â†’  frontend-service:8005
/menu/drink                       â†’  frontend-service:8005
/login                            â†’  frontend-service:8005
/api/products                     â†’  gateway-service:8000
/api/orders                       â†’  gateway-service:8000
/api/auth/login                   â†’  gateway-service:8000
/eureka                           â†’  eureka-server:8761
```

---

## 7. ì„œë¹„ìŠ¤ ê°„ í†µì‹ 

### 7.1 ë™ê¸° í†µì‹  (REST API)

```
[ì£¼ë¬¸ ì¡°íšŒ ìš”ì²­ íë¦„]

ì‚¬ìš©ì ë¸Œë¼ìš°ì €
      â”‚
      â”‚ GET /order/history
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  frontend   â”‚
â”‚  service    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ REST API í˜¸ì¶œ
       â”‚ GET http://gateway-service:8000/api/orders/history
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   gateway   â”‚
â”‚   service   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ ë¼ìš°íŒ…
       â”‚ GET http://order-service:8002/api/orders/history
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    order    â”‚
â”‚   service   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ DB ì¡°íšŒ
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  order_db   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 ë¹„ë™ê¸° í†µì‹  (RabbitMQ)

```
[ì£¼ë¬¸ ì™„ë£Œ â†’ ì¬ê³  ì°¨ê°]

ë™ê¸°ë¡œ í•˜ë©´? ğŸ¤”
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
order-service: "ì¬ê³  ì°¨ê°í•´ì¤˜"
       â”‚
       â–¼ (ëŒ€ê¸°...)
inventory-service: "ì ê¹ë§Œ... DB ëŠë ¤..."
       â”‚
       â–¼ (3ì´ˆ í›„)
order-service: "ì•„ ë“œë””ì–´ ì‘ë‹µì™”ë‹¤"
ì‚¬ìš©ì: "ì™œ ì´ë ‡ê²Œ ëŠë ¤?" ğŸ˜ 

ë¹„ë™ê¸°ë¡œ í•˜ë©´! ğŸ˜Š
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
order-service: "ì¬ê³  ì°¨ê°í•´ì¤˜" â†’ [RabbitMQ] â†’ "ë©”ì‹œì§€ ë„£ì–´ë‘˜ê²Œ"
       â”‚                              â”‚
       â–¼ (ì¦‰ì‹œ ì‘ë‹µ)                    â–¼ (ë‚˜ì¤‘ì— ì²˜ë¦¬)
ì‚¬ìš©ì: "ì£¼ë¬¸ ì™„ë£Œ!" ğŸ‰          inventory-service: "ì˜¤ ë©”ì‹œì§€ ì™”ë„¤, ì²˜ë¦¬í• ê²Œ"
```

```
[RabbitMQ ë©”ì‹œì§€ íë¦„]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    order    â”‚         â”‚  RabbitMQ   â”‚         â”‚  inventory  â”‚
â”‚   service   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   service   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ publish â”‚ order.queue â”‚ consume â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ë©”ì‹œì§€ ë‚´ìš©:
{
  "orderId": 123,
  "items": [
    {"productId": 1, "quantity": 2},
    {"productId": 5, "quantity": 1}
  ]
}

inventory-serviceê°€ ë°›ì•„ì„œ:
â†’ ì•„ë©”ë¦¬ì¹´ë…¸ ì›ë‘ -40g
â†’ ë¼ë–¼ ìš°ìœ  -200ml
```

### 7.3 ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ (Eureka)

```
ì„œë¹„ìŠ¤ë“¤ì´ ì„œë¡œë¥¼ ì–´ë–»ê²Œ ì°¾ì„ê¹Œ?

[Eureka Server]
      â”‚
      â”‚ ë“±ë¡ (register)
      â”‚
â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
â”‚           â”‚
â–¼           â–¼
member      product
service     service
(8004)      (8001)

1. ê° ì„œë¹„ìŠ¤ê°€ Eurekaì— ìì‹ ì„ ë“±ë¡
2. ë‹¤ë¥¸ ì„œë¹„ìŠ¤ ì°¾ì„ ë•Œ Eurekaì— ë¬¼ì–´ë´„
3. Eurekaê°€ "product-serviceëŠ” 10.0.0.15:8001 ì´ì•¼" ì•Œë ¤ì¤Œ

K8sì—ì„œëŠ”?
â†’ K8s Service + DNSë¡œ ëŒ€ì²´ ê°€ëŠ¥
â†’ í•˜ì§€ë§Œ Eurekaë„ í•¨ê»˜ ì‚¬ìš© (Spring Cloud í˜¸í™˜ì„±)
```

---

## 8. ë¦¬ì†ŒìŠ¤ ê´€ë¦¬

### 8.1 requests vs limits

```yaml
resources:
  requests:          # "ìµœì†Œ ì´ë§Œí¼ì€ í•„ìš”í•´ìš”"
    memory: "256Mi"  # 256 MiB ë©”ëª¨ë¦¬
    cpu: "250m"      # 0.25 CPU ì½”ì–´ (1000m = 1ì½”ì–´)
  limits:            # "ìµœëŒ€ ì´ë§Œí¼ë§Œ ì“¸ê²Œìš”"
    memory: "384Mi"
    cpu: "500m"
```

```
[ìŠ¤ì¼€ì¤„ë§ ì‹œ]

Node A (4GB ë©”ëª¨ë¦¬)
â”œâ”€â”€ ì‚¬ìš© ì¤‘: 3GB
â””â”€â”€ ë‚¨ì€ ê³µê°„: 1GB

ìƒˆ íŒŒë“œ (requests: 512Mi)
â†’ Node Aì— ë°°ì¹˜ ê°€ëŠ¥! âœ…

ìƒˆ íŒŒë“œ (requests: 2GB)
â†’ Node Aì— ë°°ì¹˜ ë¶ˆê°€ âŒ
â†’ ë‹¤ë¥¸ ë…¸ë“œ ì°¾ê±°ë‚˜, ë…¸ë“œ ì¶”ê°€ í•„ìš”
```

### 8.2 ìš°ë¦¬ í”„ë¡œì íŠ¸ ë¦¬ì†ŒìŠ¤ í• ë‹¹

| ì„œë¹„ìŠ¤ | CPU (req/limit) | Memory (req/limit) | ì´ìœ  |
|--------|-----------------|---------------------|------|
| ì¼ë°˜ ì„œë¹„ìŠ¤ | 250m / 500m | 256Mi / 384Mi | Spring Boot ê¸°ë³¸ |
| MySQL | 250m / 500m | 512Mi / 768Mi | DBëŠ” ë©”ëª¨ë¦¬ ë§ì´ ì‚¬ìš© |
| RabbitMQ | 250m / 500m | 512Mi / 768Mi | ë©”ì‹œì§€ ë²„í¼ë§ |
| Eureka | 250m / 500m | 384Mi / 512Mi | ì„œë¹„ìŠ¤ ëª©ë¡ ìºì‹± |

### 8.3 OOMKilled (ë©”ëª¨ë¦¬ ë¶€ì¡±)

```
íŒŒë“œê°€ limitsë¥¼ ì´ˆê³¼í•˜ë©´?

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pod: order-service              â”‚
â”‚ Memory Limit: 384Mi            â”‚
â”‚                                 â”‚
â”‚ í˜„ì¬ ì‚¬ìš©: 380Mi... 390Mi! ğŸ’¥   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    OOMKilled (Out Of Memory)
    â†’ íŒŒë“œ ê°•ì œ ì¢…ë£Œ
    â†’ K8sê°€ ìë™ìœ¼ë¡œ ìƒˆ íŒŒë“œ ìƒì„±

í™•ì¸ ë°©ë²•:
kubectl describe pod <íŒŒë“œëª…> -n tori-app
â†’ Last State: Terminated
â†’ Reason: OOMKilled
```

---

## 9. ë°ì´í„° ì˜ì†ì„± (PV/PVC)

### 9.1 PVì™€ PVCë€?

```
PV (Persistent Volume)
= ì‹¤ì œ ë¬¼ë¦¬ì  ì €ì¥ì†Œ (EBS ë³¼ë¥¨)
= "ì°½ê³ "

PVC (Persistent Volume Claim)
= ì €ì¥ì†Œ ìš”ì²­ì„œ
= "ì°½ê³  10GB ë¹Œë ¤ì£¼ì„¸ìš”"

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Kubernetes                    â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚    PVC      â”‚      â”‚     PV      â”‚      â”‚
â”‚  â”‚ "10GB í•„ìš”"  â”‚â”€â”€â”€â”€â”€â–¶â”‚ "10GB EBS"  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                    â”‚             â”‚
â”‚         â”‚                    â–¼             â”‚
â”‚         â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚         â”‚            â”‚ AWS EBS     â”‚       â”‚
â”‚         â”‚            â”‚ ì‹¤ì œ ë””ìŠ¤í¬   â”‚       â”‚
â”‚         â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚    Pod      â”‚                           â”‚
â”‚  â”‚   (MySQL)   â”‚ â† /var/lib/mysqlì— ë§ˆìš´íŠ¸  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 StatefulSetì—ì„œ PVC

```yaml
# mysql-product.yaml

volumeClaimTemplates:     # StatefulSet ì „ìš©
  - metadata:
      name: mysql-storage
    spec:
      accessModes: ["ReadWriteOnce"]   # í•˜ë‚˜ì˜ íŒŒë“œë§Œ ì“°ê¸° ê°€ëŠ¥
      storageClassName: gp3            # AWS EBS gp3 íƒ€ì…
      resources:
        requests:
          storage: 10Gi                # 10GB ìš”ì²­
```

```
[íŒŒë“œê°€ ì£½ì—ˆì„ ë•Œ]

Before:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ mysql-product-0  â”‚â”€â”€â”€â”€â–¶â”‚ EBS Volume   â”‚
â”‚   IP: 10.0.0.15  â”‚     â”‚  (10GB)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  ë°ì´í„° ìˆìŒ   â”‚
        âŒ ì£½ìŒ!          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ mysql-product-0  â”‚â”€â”€â”€â”€â–¶â”‚ EBS Volume   â”‚
â”‚   IP: 10.0.0.99  â”‚     â”‚  (10GB)      â”‚  â† ê°™ì€ ë³¼ë¥¨!
â”‚   (ìƒˆë¡œ ìƒì„±)     â”‚     â”‚  ë°ì´í„° ìœ ì§€!  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

IPëŠ” ë°”ë€Œì–´ë„ ë°ì´í„°ëŠ” ì•ˆì „! ğŸ‰
```

---

## 10. ConfigMapê³¼ Secret

### 10.1 ConfigMap (ì„¤ì •ê°’)

```yaml
# k8s/base/configmap.yaml

apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: tori-app
data:
  # ì„œë¹„ìŠ¤ URLë“¤ (ë¯¼ê°í•˜ì§€ ì•ŠìŒ)
  EUREKA_SERVER_URL: "http://eureka-server:8761/eureka"
  SERVICE_MEMBER_URL: "http://member-service:8004"
  SERVICE_PRODUCT_URL: "http://product-service:8001"
  SERVICE_ORDER_URL: "http://order-service:8002"

  # ì„¤ì •ê°’
  EUREKA_INSTANCE_PREFER_IP_ADDRESS: "true"
```

**ì‚¬ìš© ë°©ë²•:**
```yaml
# Deploymentì—ì„œ

env:
  - name: EUREKA_CLIENT_SERVICEURL_DEFAULTZONE
    valueFrom:
      configMapKeyRef:
        name: app-config
        key: EUREKA_SERVER_URL
```

### 10.2 Secret (ë¹„ë°€ê°’)

```yaml
# k8s/base/secrets.yaml

apiVersion: v1
kind: Secret
metadata:
  name: db-secrets
  namespace: tori-app
type: Opaque
stringData:                          # í‰ë¬¸ìœ¼ë¡œ ì‘ì„±
  MYSQL_MEMBER_PASSWORD: "password123"
  JWT_SECRET: "super-secret-key"

# K8sê°€ ìë™ìœ¼ë¡œ Base64 ì¸ì½”ë”©
# ì €ì¥ë  ë•Œ: cGFzc3dvcmQxMjM=
```

**ì™œ ë¶„ë¦¬í•˜ëŠ”ê°€?**

```
[ConfigMap]                    [Secret]
- Gitì— ì˜¬ë ¤ë„ ë¨ âœ…            - Gitì— ì˜¬ë¦¬ë©´ ì•ˆë¨ âŒ
- ëˆ„êµ¬ë‚˜ ë´ë„ ë¨               - ì•”í˜¸í™” ì €ì¥
- URL, í¬íŠ¸, ì„¤ì •              - ë¹„ë°€ë²ˆí˜¸, API Key, í† í°

ìš°ë¦¬ í”„ë¡œì íŠ¸:
secrets.yaml â†’ Gitì—ëŠ” ë”ë¯¸ê°’
secrets-real.yaml â†’ ë³„ë„ ë³´ê´€ (k8s/scripts/backup/)
```

---

## 11. í—¬ìŠ¤ ì²´í¬ (Probe)

### 11.1 ì„¸ ê°€ì§€ Probe

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Pod                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Container                         â”‚ â”‚
â”‚  â”‚                                               â”‚ â”‚
â”‚  â”‚   livenessProbe    "ì‚´ì•„ìˆë‹ˆ?"                â”‚ â”‚
â”‚  â”‚        â”‚           â†’ ì‹¤íŒ¨ ì‹œ ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘    â”‚ â”‚
â”‚  â”‚        â–¼                                      â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚ â”‚
â”‚  â”‚   â”‚   App   â”‚                                 â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚ â”‚
â”‚  â”‚        â–²                                      â”‚ â”‚
â”‚  â”‚        â”‚                                      â”‚ â”‚
â”‚  â”‚   readinessProbe   "ì¤€ë¹„ëë‹ˆ?"                â”‚ â”‚
â”‚  â”‚                    â†’ ì‹¤íŒ¨ ì‹œ íŠ¸ë˜í”½ ì•ˆë³´ëƒ„      â”‚ â”‚
â”‚  â”‚                                               â”‚ â”‚
â”‚  â”‚   startupProbe     "ì‹œì‘ëë‹ˆ?"                â”‚ â”‚
â”‚  â”‚                    â†’ ì‹œì‘ ì¤‘ì—ëŠ” ë‹¤ë¥¸ ì²´í¬ ì¤‘ì§€ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.2 ìš°ë¦¬ í”„ë¡œì íŠ¸ ì„¤ì •

```yaml
# frontend-service.yaml

livenessProbe:
  httpGet:
    path: /                   # ì´ URLë¡œ ì²´í¬
    port: 8005
  initialDelaySeconds: 60     # ì‹œì‘ í›„ 60ì´ˆ ëŒ€ê¸°
  periodSeconds: 10           # 10ì´ˆë§ˆë‹¤ ì²´í¬

readinessProbe:
  httpGet:
    path: /
    port: 8005
  initialDelaySeconds: 30     # ì‹œì‘ í›„ 30ì´ˆ ëŒ€ê¸°
  periodSeconds: 5            # 5ì´ˆë§ˆë‹¤ ì²´í¬
```

### 11.3 ì‹¤ì œ ì‹œë‚˜ë¦¬ì˜¤

```
[ì‹œë‚˜ë¦¬ì˜¤: ì„œë¹„ìŠ¤ ë°°í¬]

0ì´ˆ:  ìƒˆ íŒŒë“œ ìƒì„±
      livenessProbe: ëŒ€ê¸° (initialDelaySeconds: 60)
      readinessProbe: ëŒ€ê¸° (initialDelaySeconds: 30)

30ì´ˆ: Spring Boot ì•„ì§ ì‹œì‘ ì¤‘...
      readinessProbe ì‹œì‘ â†’ ì‹¤íŒ¨ (ì•„ì§ ì¤€ë¹„ ì•ˆë¨)
      â†’ íŠ¸ë˜í”½ ì•ˆë³´ëƒ„ âœ…

45ì´ˆ: Spring Boot ì‹œì‘ ì™„ë£Œ!
      readinessProbe â†’ ì„±ê³µ!
      â†’ íŠ¸ë˜í”½ ë°›ê¸° ì‹œì‘ âœ…

60ì´ˆ: livenessProbe ì‹œì‘ â†’ ì„±ê³µ!
      â†’ ê³„ì† ëª¨ë‹ˆí„°ë§

300ì´ˆ: ì•± ë‚´ë¶€ ë°ë“œë½ ë°œìƒ! ğŸ˜±
       livenessProbe â†’ ì‹¤íŒ¨!
       â†’ K8sê°€ ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
       â†’ ìë™ ë³µêµ¬! ğŸ‰
```

---

## 12. ì‹¤ì œ íŠ¸ë˜í”½ íë¦„

### 12.1 ì „ì²´ íë¦„ë„

```
[ì‚¬ìš©ìê°€ ì•„ë©”ë¦¬ì¹´ë…¸ ì£¼ë¬¸í•˜ëŠ” ê³¼ì •]

1. ë¸Œë¼ìš°ì €ì—ì„œ ì£¼ë¬¸ ë²„íŠ¼ í´ë¦­
   â”‚
   â–¼
2. ALB (k8s-toriapp-xxx.elb.amazonaws.com)
   â”‚ /api/order/place
   â–¼
3. Ingress ê·œì¹™ í™•ì¸
   â”‚ path: /api â†’ gateway-service
   â–¼
4. gateway-service (8000)
   â”‚ ë¼ìš°íŒ…: /api/order/** â†’ order-service
   â–¼
5. order-service (8002)
   â”‚ â”œâ”€ ì£¼ë¬¸ ë°ì´í„° ì €ì¥ â†’ order_db
   â”‚ â””â”€ ì¬ê³  ì°¨ê° ìš”ì²­ â†’ RabbitMQ
   â–¼
6. RabbitMQ
   â”‚ order.queueì— ë©”ì‹œì§€ ì €ì¥
   â–¼
7. inventory-service (8008)
   â”‚ ë©”ì‹œì§€ ìˆ˜ì‹  â†’ ì¬ê³  ì°¨ê° â†’ inventory_db
   â–¼
8. ì™„ë£Œ!
```

### 12.2 DNS í•´ì„ ê³¼ì •

```
frontend-service ì—ì„œ gateway-service í˜¸ì¶œí•  ë•Œ:

http://gateway-service:8000/api/products

1. gateway-service ì´ë¦„ìœ¼ë¡œ DNS ì¡°íšŒ
   â”‚
   â–¼
2. CoreDNS (K8s ë‚´ë¶€ DNS)
   "gateway-service.tori-app.svc.cluster.local"
   â†’ 10.100.50.30 (ClusterIP)
   â”‚
   â–¼
3. kube-proxyê°€ ì‹¤ì œ íŒŒë“œë¡œ ë¶„ì‚°
   â†’ 10.0.1.15:8000 (Pod 1)
   â†’ 10.0.2.20:8000 (Pod 2)
```

### 12.3 ì¥ì•  ë°œìƒ ì‹œ ë™ì‘

```
[ì‹œë‚˜ë¦¬ì˜¤: order-service íŒŒë“œ 1ê°œ ì£½ìŒ]

Before (ì •ìƒ):
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   ALB     â”‚
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼          â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚order-1â”‚ â”‚order-2â”‚ â”‚order-3â”‚  ëª¨ë‘ ì •ìƒ
â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜

After (order-2 ì£½ìŒ):
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   ALB     â”‚
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼          â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚order-1â”‚ â”‚order-2â”‚ â”‚order-3â”‚
â”‚  âœ…   â”‚ â”‚  âŒ   â”‚ â”‚  âœ…   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜

1. livenessProbe ì‹¤íŒ¨ ê°ì§€ (10ì´ˆ)
2. order-2 íŒŒë“œ ì¬ì‹œì‘ ì‹œë„
3. readinessProbe ì‹¤íŒ¨ â†’ íŠ¸ë˜í”½ ì œì™¸
4. ALBëŠ” order-1, order-3ì—ë§Œ íŠ¸ë˜í”½ ì „ì†¡
5. ì‚¬ìš©ìëŠ” ì¥ì• ë¥¼ ëŠë¼ì§€ ëª»í•¨! ğŸ‰
6. order-2 ë³µêµ¬ ì™„ë£Œ â†’ ë‹¤ì‹œ íŠ¸ë˜í”½ ìˆ˜ì‹ 
```

---

## ë¶€ë¡: ìì£¼ ì“°ëŠ” ëª…ë ¹ì–´

```bash
# íŒŒë“œ ìƒíƒœ í™•ì¸
kubectl get pods -n tori-app

# íŒŒë“œ ìƒì„¸ ì •ë³´ (ì´ë²¤íŠ¸, ì—ëŸ¬ í™•ì¸)
kubectl describe pod <íŒŒë“œëª…> -n tori-app

# íŒŒë“œ ë¡œê·¸ ë³´ê¸°
kubectl logs <íŒŒë“œëª…> -n tori-app
kubectl logs -f <íŒŒë“œëª…> -n tori-app  # ì‹¤ì‹œê°„

# HPA ìƒíƒœ í™•ì¸
kubectl get hpa -n tori-app

# ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ í™•ì¸
kubectl top pods -n tori-app
kubectl top nodes

# ì„œë¹„ìŠ¤ í™•ì¸
kubectl get svc -n tori-app

# Ingress í™•ì¸
kubectl get ingress -n tori-app

# ConfigMap/Secret í™•ì¸
kubectl get configmap -n tori-app
kubectl get secret -n tori-app

# MySQL ì ‘ì†
kubectl exec -it mysql-product-0 -n tori-app -- mysql -u root -p

# íŒŒë“œ ë‚´ë¶€ ì ‘ì†
kubectl exec -it <íŒŒë“œëª…> -n tori-app -- sh
```

---

## ë§ˆë¬´ë¦¬

ì´ ë¬¸ì„œì—ì„œ ë‹¤ë£¬ í•µì‹¬ ê°œë…:

| ê°œë… | í•œ ì¤„ ìš”ì•½ |
|------|----------|
| **MSA** | ì„œë¹„ìŠ¤/DBë¥¼ ë¶„ë¦¬í•´ì„œ ë…ë¦½ì ìœ¼ë¡œ ê°œë°œ/ë°°í¬/í™•ì¥ |
| **Container** | ì•± + í™˜ê²½ì„ íŒ¨í‚¤ì§•, ì–´ë””ì„œë“  ë™ì¼í•˜ê²Œ ì‹¤í–‰ |
| **Pod** | K8s ë°°í¬ ìµœì†Œ ë‹¨ìœ„, ì»¨í…Œì´ë„ˆ 1ê°œ ì´ìƒ |
| **Deployment** | íŒŒë“œ ê°œìˆ˜ ìœ ì§€, ìë™ ë³µêµ¬ |
| **Service** | íŒŒë“œë“¤ì—ê²Œ ê³ ì • IP/DNS ì œê³µ |
| **HPA** | CPU/ë©”ëª¨ë¦¬ ê¸°ë°˜ ìë™ ìŠ¤ì¼€ì¼ë§ |
| **Ingress** | ì™¸ë¶€ íŠ¸ë˜í”½ì„ ë‚´ë¶€ ì„œë¹„ìŠ¤ë¡œ ë¼ìš°íŒ… |
| **PV/PVC** | íŒŒë“œê°€ ì£½ì–´ë„ ë°ì´í„° ìœ ì§€ |
| **ConfigMap** | ì„¤ì •ê°’ ê´€ë¦¬ (URL, í¬íŠ¸ ë“±) |
| **Secret** | ë¹„ë°€ê°’ ê´€ë¦¬ (ë¹„ë°€ë²ˆí˜¸, í† í°) |
| **Probe** | í—¬ìŠ¤ ì²´í¬ë¡œ ìë™ ë³µêµ¬ |

---

*ì‘ì„±ì¼: 2026-01-19*
*í”„ë¡œì íŠ¸: TORI COFFEE*